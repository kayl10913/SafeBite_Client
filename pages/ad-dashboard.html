<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="../assets/css/Admin-assets/sidebar.css">
    <link rel="stylesheet" href="../assets/css/Admin-assets/dashboard.css">
    <script src="../assets/js/config/quiet-console.js"></script>
  <link rel="stylesheet" href="../assets/css/Admin-assets/analyticstat.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/ad-chart.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/spoilageReport.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/report-generator.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/user.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/feedbacks.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/account-modal.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/admin-log.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/device-management.css?v=1.2">
  <link rel="stylesheet" href="../assets/css/Admin-assets/ml-predictions.css?v=1.0">
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.js"></script>
  <script>
    // Fallback if unpkg fails
    if (typeof window.jspdf === 'undefined') {
      document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"><\/script>');
      document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"><\/script>');
    }
  </script>
</head>
<body>
<aside class="sidebar expanded" id="sidebar">
  <div class="sidebar-header">
    <span class="sidebar-logo" id="sidebarLogo" style="cursor:pointer;">&#128230;</span>
    <span class="sidebar-title">Admin</span>
  </div>
  <nav class="sidebar-nav">
    <!-- Core System Section -->
    <div class="nav-section">
      <div class="nav-section-header">Core System</div>
      <ul>
        <li class="nav-item active">
          <a href="#" class="nav-link" data-page="dashboard" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#8962;</span>
            <span class="nav-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="analytics-summary" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128200;</span>
            <span class="nav-text">Sensor Analytics</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="ml-predictions" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#129302;</span>
            <span class="nav-text">ML Predictions</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="device-management" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128187;</span>
            <span class="nav-text">Device Management</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Reports Section -->
    <div class="nav-section">
      <div class="nav-section-header">Reports</div>
      <ul>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="report-generator" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128229;</span>
            <span class="nav-text">Report Generator</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- User Management Section -->
    <div class="nav-section">
      <div class="nav-section-header">User Management</div>
      <ul>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="users" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128101;</span>
            <span class="nav-text">Users</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="user-activity-log" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128221;</span>
            <span class="nav-text">User Activity Log</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="admin-log" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128273;</span>
            <span class="nav-text">Admin Logs</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Support Section -->
    <div class="nav-section">
      <div class="nav-section-header">Support</div>
      <ul>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="feedbacks" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128172;</span>
            <span class="nav-text">Feedback & Support</span>
          </a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="sidebar-account" id="sidebarAccountBtn" onclick="openAdminAccountModal()" style="cursor: pointer;">
    <span class="account-icon">&#128100;</span>
    <span class="account-text">Account</span>
    <button class="logout-btn" id="logoutBtn" type="button" style="background:none;border:none;color:#666;cursor:pointer;margin-left:auto;font-size:12px;" onclick="event.stopPropagation();">Logout</button>
  </div>
</aside>
<main id="main-content">
  <!-- Content will be loaded here by spa.js -->
</main>

<template id="dashboard-template">
    <div class="dashboard-container">
        <div class="dashboard-row">
          <div class="dashboard-card sensors-card">
            <div class="sensors-header">
              <h4>Dashboard</h4>
            </div>
            <div class="stat-cards-container">
              <div class="stat-card">
                <div class="stat-card-header">
                  <div class="stat-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value" id="activeUsersCount">0</div>
                    <div class="stat-label">Active Users</div>
                  </div>
                </div>
                <div class="stat-chart">
                  <canvas id="userChart"></canvas>
                </div>
              </div>
              <div class="stat-card highlight">
                <div class="stat-card-header">
                  <div class="stat-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M21.75 8a.75.75 0 00-.75-.75h-2.25a.75.75 0 000 1.5h2.25a.75.75 0 00.75-.75z"/><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM3.75 12a8.25 8.25 0 1116.5 0 8.25 8.25 0 01-16.5 0z"/></svg>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value" id="deviceReportsCount">0</div>
                    <div class="stat-label">Device Reports</div>
                  </div>
                </div>
                <div class="stat-chart">
                  <canvas id="deviceChart"></canvas>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-card-header">
                  <div class="stat-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value" id="activeDevicesCount">0</div>
                  <div class="stat-label">Active Devices</div>
                  </div>
                </div>
                <div class="stat-chart">
                  <canvas id="alertChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="dashboard-row">
          <div class="dashboard-card tall activity-card" style="flex:2;">
            <div class="activity-header">
              <span class="activity-title">Device Used Count</span>
              <select class="activity-filter">
                <option selected>Monthly</option>
                <option>Yearly</option>
              </select>
            </div>
            <div class="activity-counters" style="display:flex;flex-direction:column;gap:6px;background:#162449;border:1px solid #243760;border-radius:8px;padding:10px 12px;margin:6px 0 10px 0;color:#bfc9da;">
              <div id="count-today">Today: 0</div>
              <div id="count-7d">Last 7d: 0</div>
              <div id="count-30d">Last 30d: 0</div>
            </div>
            <canvas id="activityChart"></canvas>
          </div>
          <div class="dashboard-card tall recent-reviews-card" style="flex:1;display:flex;flex-direction:column;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin:0 0 20px 0;">
              <h4 style="margin:0;color:#fff;font-size:1.4em;font-weight:600;">Recent Reviews</h4>
              <span id="reviews-date" style="color:#8a9bb5;font-size:0.9em;font-weight:500;">Today</span>
            </div>
            <div id="recent-reviews-container" class="recent-reviews-container">
              <div class="loading-reviews">Loading reviews...</div>
            </div>
          </div>
        </div>
      </div>
</template>

<!-- ML Predictions & Analytics -->
<template id="ml-predictions-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>ML Predictions & Analytics</h1>
        <div class="spoilage-subtitle">Explore AI-driven spoilage predictions and model performance</div>
      </div>
      
    </div>

    <div class="ml-kpi-row">
      <div class="ml-kpi-card"><div class="ml-kpi-title">Total Predictions</div><div class="ml-kpi-value" id="mlKpiTotal">0</div><div class="ml-kpi-sub" id="mlKpiTotalSub">+0 today</div></div>
      <div class="ml-kpi-card"><div class="ml-kpi-title">Average Confidence</div><div class="ml-kpi-value" id="mlKpiConfidence">--%</div><div class="ml-kpi-sub" id="mlKpiConfidenceSub">+0% this week</div></div>
      <div class="ml-kpi-card"><div class="ml-kpi-title">Training Data</div><div class="ml-kpi-value" id="mlKpiSamples">0</div><div class="ml-kpi-sub" id="mlKpiSamplesSub">+0 added</div></div>
      <div class="ml-kpi-card"><div class="ml-kpi-title">Model Accuracy</div><div class="ml-kpi-value" id="mlKpiAccuracy">--%</div><div class="ml-kpi-sub" id="mlKpiAccuracySub">+0% improved</div></div>
    </div>

    

    <div class="ml-card" style="margin-top:16px;">
      <div class="ml-card-header">
        <div class="ml-card-title">Training Data (<span id="mlSamplesCount">0</span>)</div>
        <div class="ml-actions">
          <button class="ml-btn primary" id="mlAddTraining">+ Add Training Data</button>
        </div>
      </div>
      <table class="ml-table">
        <thead>
          <tr>
            <th>Food Category</th>
            <th>Environmental Conditions</th>
            <th>Actual Status</th>
            <th>Data Quality</th>
            <th>Source</th>
            <th>Date Added</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="mlSamplesTableBody"></tbody>
      </table>
        <div id="mlSamplesPagination" class="pagination-container" style="display:none;margin-top:10px;">
          <div id="mlSamplesPageInfo" class="pagination-info"></div>
          <div id="mlSamplesPageControls" class="pagination-controls"></div>
        </div>
    </div>
    
    <!-- Update Training Data Modal -->
    <div id="updateTrainingDataModal" class="modal" style="display: none;">
      <div class="modal-content update-modal">
        <div class="modal-header update-modal-header">
          <h3 class="update-modal-title">
            <span class="update-modal-icon">✏️</span>
            Update Training Data
          </h3>
          <span class="close update-modal-close" id="closeUpdateTrainingModal">&times;</span>
        </div>
        <div class="modal-body update-modal-body">
          <div class="update-modal-info">
            <p class="update-modal-info-text">
              <span class="update-modal-info-icon">ℹ️</span>
              Update the details for the training data sample.
            </p>
          </div>
          
          <form id="updateTrainingDataForm">
            <!-- Food Information Section -->
            <div class="update-modal-section">
              <h4 class="update-modal-section-title">
                <span>🍎</span> Food Information
              </h4>
              <div class="update-modal-form-row">
                <div class="update-modal-form-group">
                  <label for="updateFoodName" class="update-modal-label">Food Name</label>
                  <input type="text" id="updateFoodName" name="foodName" placeholder="e.g., Banana" readonly class="update-modal-input">
                </div>
                <div class="update-modal-form-group">
                  <label for="updateCategory" class="update-modal-label">Category</label>
                  <input type="text" id="updateCategory" name="category" placeholder="e.g., Fruits" readonly class="update-modal-input">
                </div>
              </div>
            </div>
            
            <!-- Environmental Conditions Section -->
            <div class="update-modal-section">
              <h4 class="update-modal-section-title">
                <span>🌡️</span> Environmental Conditions
              </h4>
              <div class="update-modal-form-row-three">
                <div class="update-modal-form-group">
                  <label for="updateTemperature" class="update-modal-label">🌡️ Temp (°C)</label>
                  <input type="number" id="updateTemperature" name="temperature" placeholder="25.0" step="0.1" required class="update-modal-input">
                </div>
                <div class="update-modal-form-group">
                  <label for="updateHumidity" class="update-modal-label">💧 Humidity (%)</label>
                  <input type="number" id="updateHumidity" name="humidity" placeholder="50.0" step="0.1" required class="update-modal-input">
                </div>
                <div class="update-modal-form-group">
                  <label for="updatePh" class="update-modal-label">💨 Gas (ppm)</label>
                  <input type="number" id="updatePh" name="ph" placeholder="100.0" step="0.1" required class="update-modal-input">
                </div>
              </div>
            </div>
            
            <!-- Status & Quality Section -->
            <div class="update-modal-section">
              <h4 class="update-modal-section-title">
                <span>📊</span> Status & Quality
              </h4>
              <div class="update-modal-form-row">
                <div class="update-modal-form-group">
                  <label for="updateActualStatus" class="update-modal-label">Actual Status</label>
                  <select id="updateActualStatus" name="actualStatus" required class="update-modal-select">
                    <option value="">Select status</option>
                    <option value="safe" class="update-modal-option safe">✅ Safe</option>
                    <option value="caution" class="update-modal-option caution">⚠️ Caution</option>
                    <option value="unsafe" class="update-modal-option unsafe">❌ Unsafe</option>
                  </select>
                </div>
                <div class="update-modal-form-group">
                  <label for="updateSource" class="update-modal-label">Data Source</label>
                  <select id="updateSource" name="source" required class="update-modal-select">
                    <option value="">Select source</option>
                    <option value="manual" class="update-modal-option">👤 Manual</option>
                    <option value="sensor" class="update-modal-option">📡 Sensor</option>
                    <option value="user_feedback" class="update-modal-option">💬 User Feedback</option>
                    <option value="expert" class="update-modal-option">🎓 Expert</option>
                  </select>
                </div>
              </div>
              <div class="update-modal-form-group">
                <label for="updateDataQuality" class="update-modal-label">Data Quality (%)</label>
                <input type="number" id="updateDataQuality" name="dataQuality" placeholder="95" min="0" max="100" step="1" required class="update-modal-input">
              </div>
            </div>
            
            <!-- Environmental Factors Section -->
            <div class="update-modal-section">
              <h4 class="update-modal-section-title">
                <span>🌍</span> Environmental Factors
              </h4>
              <div class="update-modal-form-group">
                <label for="updateEnvironmentalFactors" class="update-modal-label">Additional Environmental Data (JSON)</label>
                <textarea id="updateEnvironmentalFactors" name="environmentalFactors" placeholder='{"notes": "Additional observations", "location": "Storage area", "conditions": "Normal"}' class="update-modal-textarea" rows="3"></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="update-modal-footer">
          <button type="button" class="update-modal-btn update-modal-btn-secondary" id="cancelUpdateTrainingBtn">Cancel</button>
          <button type="button" class="update-modal-btn update-modal-btn-primary" id="updateTrainingDataBtn">Update Training Data</button>
        </div>
      </div>
    </div>
  </div>
</template>

<!-- ML Predictions & Analytics - Detail -->
<template id="ml-predictions-detail-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>ML Predictions & Analytics</h1>
        <div class="spoilage-subtitle">Detailed prediction records with filters and export</div>
      </div>
      
    </div>
    <div class="report-generator-card">
      <div class="report-controls">
        <div class="report-control-group">
          <label for="mlSearch">Search</label>
          <input id="mlSearch" class="report-date-input" placeholder="Device, user, or model" />
        </div>
        <div class="report-control-group">
          <label for="mlDateRange">Date Range</label>
          <select id="mlDateRange" class="report-select">
            <option value="all">All Time</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
        <div class="report-control-group" id="mlWeekGroup" style="display:none;min-width:200px;">
          <label for="mlWeekPicker">Select Week</label>
          <input type="week" id="mlWeekPicker" />
        </div>
        <div class="report-control-group" id="mlMonthGroup" style="display:none;min-width:200px;">
          <label for="mlMonthPicker">Select Month</label>
          <input type="month" id="mlMonthPicker" />
        </div>
        <div class="report-control-group" id="mlYearGroup" style="display:none;min-width:160px;">
          <label for="mlYearPicker">Select Year</label>
          <input type="number" id="mlYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
        </div>
        <div class="report-control-group">
          <label for="mlRecordsPerPage">Records per Page</label>
          <select id="mlRecordsPerPage" class="report-select">
            <option value="10">10</option>
            <option value="25" selected>25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
      </div>
      <div class="report-actions">
        <button id="mlApplyFilters" class="report-btn report-btn-primary"><span>🔎</span>Filter</button>
        <button id="mlUpdate" class="report-btn report-btn-primary"><span>🔄</span>Update</button>
        <button id="mlExportCSV" class="report-btn report-btn-secondary"><span>📥</span>Download CSV</button>
        <button id="mlExportPDF" class="filter-btn export"><span>📄</span>Download PDF</button>
      </div>
    </div>
    <div class="report-preview">
      <h2 class="report-preview-title">ML Predictions</h2>
      <div class="report-table-container">
        <table class="admin-log-table">
          <thead>
            <tr>
              <th>DATE/TIME</th>
              <th>DEVICE</th>
              <th>USER</th>
              <th>SENSOR</th>
              <th>MODEL</th>
              <th>PREDICTION</th>
              <th>CONFIDENCE</th>
            </tr>
          </thead>
          <tbody id="mlPredictionsTableBody"></tbody>
        </table>
      </div>
      <div id="mlPagination" class="pagination-container" style="display:none;">
        <div id="mlPageInfo" class="pagination-info"></div>
        <div id="mlPageControls" class="pagination-controls"></div>
      </div>
    </div>
  </div>
</template>
<!-- Sensor Analytics Summary -->
<template id="analytics-summary-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>Sensor Analytics</h1>
        <div class="spoilage-subtitle">Monitor portable food spoilage sensors used by food testers</div>
      </div>
      <div class="spoilage-header-buttons">
        <a href="#" class="spoilage-btn active" data-page="analytics-summary">Summary</a>
        <a href="#" class="spoilage-btn" data-page="analytics-detail">Detailed View</a>
      </div>
    </div>
    <div class="spoilage-stats-row">
      <div class="spoilage-stat-card"><div class="stat-icon stat-blue">&#128230;</div><div class="stat-label">Total Sensors</div><div class="stat-value" id="totalSensorsCount">0</div></div>
      <div class="spoilage-stat-card"><div class="stat-icon stat-green">&#10003;</div><div class="stat-label">Active Testers</div><div class="stat-value" id="activeTestersCount">0</div></div>
      <div class="spoilage-stat-card"><div class="stat-icon stat-red">&#10060;</div><div class="stat-label">Spoilage Alert</div><div class="stat-value" id="spoilageAlertCount">0</div></div>
      <div class="spoilage-stat-card"><div class="stat-icon stat-gray">&#9200;</div><div class="stat-label">Inactive</div><div class="stat-value" id="inactiveCount">0</div></div>
    </div>
    <div class="spoilage-main-cards">
      <div class="spoilage-card spoilage-bar-card">
        <div class="spoilage-card-title">Sensor Usage by Tester Type</div>
        <div class="spoilage-bar-list" id="sensorUsageBars">
          <!-- Dynamic content will be populated by JavaScript -->
        </div>
      </div>
      <div class="spoilage-card spoilage-summary-card">
        <div class="spoilage-card-title">Sensor Activity Summary</div>
        <div class="spoilage-summary-list" id="sensorActivitySummary">
          <!-- Dynamic content will be populated by JavaScript -->
        </div>
        <div class="summary-total">Total Overview: <span class="summary-total-right" id="totalOverviewText">0 food testers actively using sensors</span></div>
      </div>
    </div>
  </div>
</template>

<!--Detailed-report-->
<template id="analytics-detail-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>Sensor Analytics</h1>
        <div class="spoilage-subtitle">Monitor portable food spoilage sensors used by food testers</div>
      </div>
      <div class="spoilage-header-buttons">
        <a href="#" class="spoilage-btn" data-page="analytics-summary">Summary</a>
        <a href="#" class="spoilage-btn active" data-page="analytics-detail">Detailed View</a>
      </div>
    </div>
    <div class="detailed-report-card">
      <div class="detailed-report-filters">
        <div class="filter-row">
          <div class="filter-group" style="min-width:240px;">
            <label>Name Search</label>
            <input type="text" id="nameSearch" placeholder="Search food tester name..." />
          </div>
          <div class="filter-group">
            <label>Tester Type</label>
            <select id="testerType">
              <option value="all">All Types</option>
              <!-- Will be populated dynamically from database -->
            </select>
          </div>
          <div class="filter-group">
            <label>Status</label>
            <select id="status">
              <option value="all">All Status</option>
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
              <option value="No Device">No Device</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Date Range</label>
            <select id="dateRange">
              <option value="all">All Time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group" id="analyticsWeekGroup" style="display:none;min-width:200px;">
            <label for="analyticsWeekPicker">Select Week</label>
            <input type="week" id="analyticsWeekPicker" />
          </div>
          <div class="filter-group" id="analyticsMonthGroup" style="display:none;min-width:200px;">
            <label for="analyticsMonthPicker">Select Month</label>
            <input type="month" id="analyticsMonthPicker" />
          </div>
          <div class="filter-group" id="analyticsYearGroup" style="display:none;min-width:160px;">
            <label for="analyticsYearPicker">Select Year</label>
            <input type="number" id="analyticsYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          <div class="filter-group">
            <label>Records per Page</label>
            <select id="recordsPerPage">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="filter-row"></div>
        <div class="filter-row custom-date-row" id="analyticsCustomDateGroup" style="display: none;">
          <div class="filter-group">
            <label>Start Date</label>
            <input type="date" id="startDate" />
          </div>
          <div class="filter-group">
            <label>End Date</label>
            <input type="date" id="endDate" />
          </div>
        </div>
        <div class="filter-actions">
          <button class="filter-btn" type="button" id="applyFilters" title="Apply filters" aria-label="Apply filters">🔎 Filter</button>
          <button class="filter-btn export" id="exportCSV">Export CSV</button>
          <button class="filter-btn export" id="exportPDF">Download PDF</button>
        </div>
      </div>
      <div class="detailed-report-table-card">
        <div class="detailed-report-title">Detailed Sensor Report (<span id="sensorCount">0</span> devices)</div>
        <div class="report-table-container">
        <table class="detailed-report-table admin-log-table">
          <thead>
            <tr>
              <th>FOOD TESTER</th>
              <th>TYPE</th>
              <th>STATUS</th>
              <th>LAST PING</th>
              <th>LAST READING</th>
              <th>ALERTS</th>
            </tr>
          </thead>
          <tbody id="sensorTableBody">
            <!-- Dynamic content will be populated by JavaScript -->
          </tbody>
        </table>
        </div>
        <style>
          /* Detailed table card - match report generator card styling */
          .detailed-report-table-card {
            background-color: #212c4d;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          }
          .detailed-report-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #e0e0e0;
            margin-bottom: 20px;
          }
          #analyticsPagination {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: #22336a;
            border-radius: 12px;
            border: 1px solid #344e6e;
            visibility: visible !important;
            opacity: 1 !important;
          }
          #analyticsPagination .pagination-info {
            text-align: left;
            align-self: flex-start;
            width: 100%;
            color: #bfc9da;
            font-size: 0.9em;
          }
          #analyticsPagination .pagination-controls {
            display: flex;
            justify-content: center;
            align-self: center;
            width: 100%;
          }
        </style>
        <div id="analyticsPagination" class="pagination">
          <div id="analyticsPageInfo" class="pagination-info"></div>
          <div class="pagination-controls" id="analyticsPageControls"></div>
        </div>
      </div>
    </div>
  </div>
</template>

<!-- Report Generator -->
<template id="report-generator-template">
  <div class="report-generator-main">
    <div class="report-generator-container">
      <div class="report-generator-header">
        <h1 class="report-generator-title">Report Generator</h1>
        <p class="report-generator-subtitle">Select a report type and date range to generate and download data.</p>
      </div>
      
      <div class="report-generator-card">
        <div class="report-controls">
          <div class="report-control-group">
            <label for="reportType">Report Type</label>
            <select id="reportType" class="report-select">
              <option value="new_users">New User Count</option>
              <option value="top_spoiling_food">Top Spoiling Foods</option>
            </select>
          </div>
          
          <div class="report-control-group">
            <label for="reportDateRange">Date Range</label>
            <select id="reportDateRange" class="report-select">
              <option value="All Time">All Time</option>
              <option value="Daily">Daily</option>
              <option value="Weekly">Weekly</option>
              <option value="Monthly">Monthly</option>
              <option value="Yearly">Yearly</option>
              <option value="Custom">Custom</option>
            </select>
          </div>
          
          <div class="report-control-group" id="reportWeekGroup" style="display:none;min-width:200px;">
            <label for="reportWeekPicker">Select Week</label>
            <input type="week" id="reportWeekPicker" />
          </div>
          
          <div class="report-control-group" id="reportMonthGroup" style="display:none;min-width:200px;">
            <label for="reportMonthPicker">Select Month</label>
            <input type="month" id="reportMonthPicker" />
          </div>
          
          <div class="report-control-group" id="reportYearGroup" style="display:none;min-width:160px;">
            <label for="reportYearPicker">Select Year</label>
            <input type="number" id="reportYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          
          <div class="report-control-group">
            <label for="reportRecordsPerPage">Records per Page</label>
            <select id="reportRecordsPerPage" class="report-select" onchange="changeReportRecordsPerPage(this.value)">
              <option value="10" selected>10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
          
          <div id="reportCustomDateGroup" style="display:none;">
            <div class="report-control-group">
              <label for="reportStartDate">Start Date</label>
              <input type="date" id="reportStartDate" class="report-date-input" />
            </div>
            <div class="report-control-group">
              <label for="reportEndDate">End Date</label>
              <input type="date" id="reportEndDate" class="report-date-input" />
            </div>
          </div>
          
          <div class="report-actions">
            <button id="generateReport" class="report-btn report-btn-primary">
              <span>📊</span>
              Generate Report
            </button>
            <button id="exportReportCSV" class="report-btn report-btn-secondary">
              <span>📥</span>
              Download CSV
            </button>
            <button id="exportReportPDF" class="report-btn report-btn-secondary">
              <span>📄</span>
              Download PDF
            </button>
          </div>
        </div>
        
        <div class="report-preview">
          <h2 id="reportTitle" class="report-preview-title">Report Generator</h2>
          <div class="report-table-container">
            <div id="report-preview-content">
              <div class="empty-state">
                <div class="empty-state-content">
                  <div class="empty-state-icon">📊</div>
                  <div class="empty-state-title">No Report Generated</div>
                  <div class="empty-state-desc">Select your report type and date range, then click "Generate Report" to view data.</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Pagination Container -->
          <div id="reportPagination" class="pagination-container" style="display:none;">
            <!-- Pagination will be rendered here by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>
</template>


<!-- User  -->
<template id="users-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>Users</h1>
        <div class="spoilage-subtitle">Manage clients who use your devices: create, edit, or delete accounts</div>
      </div>
    </div>
    <div class="report-generator-card">
      <div class="report-filters user-filters">
        <form autocomplete="off" data-lpignore="true" style="margin: 0; padding: 0;">
        <div class="filter-controls">
          <div class="filter-group">
            <label for="userSearch">Search</label>
            <!-- Hidden fake inputs to prevent browser autofill -->
            <input type="text" style="display:none;" autocomplete="username" />
            <input type="password" style="display:none;" autocomplete="current-password" />
            <input type="text" id="userSearch" class="user-search-input" placeholder="Search by name or email..." autocomplete="off" data-lpignore="true" data-form-type="other" />
          </div>
          
          <div class="filter-group">
            <label for="userStatusFilter">Status</label>
            <select id="userStatusFilter" class="user-filter-select">
              <option value="">All Status</option>
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="userDateRangeFilter">Date Range</label>
            <select id="userDateRangeFilter" class="user-filter-select">
              <option value="alltime">All Time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group" id="userWeekPickerGroup" style="display:none;min-width:180px;">
            <label for="userWeekPicker" style="display:block;margin-bottom:6px;">Select Week</label>
            <input type="week" id="userWeekPicker" />
          </div>
          <div class="filter-group" id="userMonthPickerGroup" style="display:none;min-width:180px;">
            <label for="userMonthPicker" style="display:block;margin-bottom:6px;">Select Month</label>
            <input type="month" id="userMonthPicker" />
          </div>
          <div class="filter-group" id="userYearPickerGroup" style="display:none;min-width:140px;">
            <label for="userYearPicker" style="display:block;margin-bottom:6px;">Select Year</label>
            <input type="number" id="userYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          <div id="userCustomDateGroup" style="display:none;">
          <div class="filter-group">
            <label for="userDateStart">Start Date</label>
            <input type="date" id="userDateStart" class="user-filter-date" />
          </div>
          <div class="filter-group">
            <label for="userDateEnd">End Date</label>
            <input type="date" id="userDateEnd" class="user-filter-date" />
            </div>
          </div>
          <div class="filter-group">
            <label for="userRecordsPerPage">Records per Page</label>
            <select id="userRecordsPerPage" onchange="changeUserRecordsPerPage(this.value)">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        </form>
        <div class="filter-actions">
          <button class="filter-btn" id="userFilterBtn">Filter</button>
          <button class="filter-btn" id="addUserBtn">+ Add User</button>
        </div>
      </div>
      <div class="report-preview-area">
        <div class="report-preview-title">Users</div>
        <table class="user-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              
              <th>Date Created</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="userTableBody">
            <!-- User rows will be rendered here by JS -->
          </tbody>
        </table>
        <div id="userPagination" class="pagination-container" style="display:none;">
          <!-- JS will render pagination here -->
        </div>
      </div>
    </div>
    
    <!-- User Modal -->
    <div class="user-modal" id="userModal" style="display:none;">
      <div class="user-modal-content" style="max-width: 500px; width: 90%;">
        <h2 id="userModalTitle">Add User</h2>
        <form id="userForm">
          <input type="hidden" id="userId" />
          
          <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div class="form-group" style="flex: 1;">
              <label for="userFirstName">First Name *</label>
              <input type="text" id="userFirstName" required placeholder="Enter first name" autocomplete="off" />
            </div>
            <div class="form-group" style="flex: 1;">
              <label for="userLastName">Last Name *</label>
              <input type="text" id="userLastName" required placeholder="Enter last name" autocomplete="off" />
            </div>
          </div>
          <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div class="form-group" style="flex: 1;">
              <label for="userEmail">Email *</label>
              <input type="email" id="userEmail" required placeholder="Enter email" autocomplete="off" />
            </div>
          </div>

          <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div class="form-group" style="flex: 1;">
              <label for="userCategory">Category *</label>
              <select id="userCategory" required>
                <option value="">Select Category</option>
                <option value="1">Personal Tester</option>
                <option value="2">Canteen Tester</option>
                <option value="3">Restaurant Tester</option>
                <option value="4">Cafeteria Tester</option>
                <option value="5">Catering Tester</option>
              </select>
            </div>
            <div class="form-group" style="flex: 1;">
              <label for="userStatus">Status *</label>
              <select id="userStatus" required>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>

          <div class="form-group" style="margin-bottom: 15px;">
            <label>Date Created</label>
            <input type="text" id="userDateCreated" readonly style="background:#181f36;color:#bfc9da;width:100%;" />
          </div>

          <div class="form-group password-group" style="display:none; margin-bottom: 15px;">
            <label for="userPassword">New Password</label>
            <div style="position:relative;display:flex;align-items:center;">
              <input type="password" id="userPassword" autocomplete="new-password" minlength="6" placeholder="Enter new password... (leave blank to keep current)" style="flex:1;width:100%;" />
              <button type="button" id="toggleUserPassword" style="position:absolute;right:10px;background:none;border:none;cursor:pointer;padding:0 6px;color:#bfc9da;" tabindex="-1" aria-label="Show password">
                  <span id="toggleUserPasswordIcon">&#128065;</span>
              </button>
            </div>
          </div>

          <div class="modal-actions" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button type="submit" class="filter-btn" style="background: #4a5b8d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">Save</button>
            <button type="button" class="filter-btn export" id="cancelUserBtn" style="background: #2a3b6d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</template>

    <!-- user ctivvity log -->
<template id="user-activity-log-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>User Activity Log</h1>
        <div class="spoilage-subtitle">View all actions performed by users/clients in the system</div>
      </div>
    </div>
    <div class="report-generator-card">
      <div class="report-controls">
        <div class="report-control-group">
          <label for="activityTypeFilter" style="display:block;margin-bottom:6px;">Activity Type</label>
          <select id="activityTypeFilter" class="report-select">
            <option value="all">All User Activities</option>
            <option value="logged in">User Login</option>
            <option value="logged out">User Logout</option>
            <option value="registered">User Registration</option>
            <option value="profile updated">Profile Update</option>
            <option value="changed password">Password Change</option>
            <option value="analysis performed">AI Analysis</option>
            <option value="chat conversation">AI Chat</option>
          </select>
        </div>
        <div class="report-control-group">
          <label for="activityDateRange" style="display:block;margin-bottom:6px;">Date Range</label>
          <select id="activityDateRange" class="report-select">
            <option value="all">All Time</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        
        <div class="report-control-group" id="activityWeekGroup" style="display:none;min-width:200px;">
          <label for="activityWeekPicker" style="display:block;margin-bottom:6px;">Select Week</label>
          <input type="week" id="activityWeekPicker" class="report-select" />
        </div>
        
        <div class="report-control-group" id="activityMonthGroup" style="display:none;min-width:200px;">
          <label for="activityMonthPicker" style="display:block;margin-bottom:6px;">Select Month</label>
          <input type="month" id="activityMonthPicker" class="report-select" />
        </div>
        
        <div class="report-control-group" id="activityYearGroup" style="display:none;min-width:160px;">
          <label for="activityYearPicker" style="display:block;margin-bottom:6px;">Select Year</label>
          <input type="number" id="activityYearPicker" class="report-select" min="1970" max="2100" step="1" placeholder="2025" />
        </div>
        
        <div class="report-control-group">
          <label for="activityRecordsPerPage" style="display:block;margin-bottom:6px;">Records per Page</label>
          <select id="activityRecordsPerPage" class="report-select" onchange="changeActivityLogRecordsPerPage(this.value)">
            <option value="10" selected>10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
        
        <div id="activityCustomDateGroup" style="display:none;">
          <div class="report-control-group">
              <label for="activityDateStart" style="display:block;margin-bottom:6px;">Start Date</label>
              <input type="date" id="activityDateStart" class="report-select" />
          </div>
          <div class="report-control-group">
              <label for="activityDateEnd" style="display:block;margin-bottom:6px;">End Date</label>
              <input type="date" id="activityDateEnd" class="report-select" />
          </div>
        </div>
        
        <div class="report-actions">
          <button id="filterActivityLogBtn" class="report-btn report-btn-primary">
            <span>🔍</span>
            Filter
          </button>
          <button id="exportActivityLogExcel" class="filter-btn export">
            <span>📥</span>
            Download Excel
          </button>
          <button id="exportActivityLogPDF" class="filter-btn export">
            <span>📄</span>
            Download PDF
          </button>
        </div>
      </div>
      <div class="report-preview">
        <h2 class="report-preview-title">Activity Log</h2>
        <div class="report-table-container">
          <table class="admin-log-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Activity</th>
                <th>Date/Time</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody id="activityLogTableBody">
              <!-- Activity rows will be rendered here by JS -->
            </tbody>
          </table>
        </div>
        <div id="activityLogPagination" class="pagination-container" style="display:none;">
          <!-- JS will render pagination here -->
        </div>
      </div>
    </div>
  </div>
</template>


    <!-- Admin activity log -->
<template id="admin-log-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>Admin Logs</h1>
        <div class="spoilage-subtitle">View all actions performed by admins in the system</div>
      </div>
    </div>
    <div class="report-generator-card">
      <div class="report-filters admin-log-filters">
        <div class="filter-controls">
                            <div class="filter-group">
                    <label for="adminLogActivityType">Activity Type</label>
                    <select id="adminLogActivityType">
                      <option value="all">All Activities</option>
                      <option value="LOGIN">Login</option>
                      <option value="LOGOUT">Logout</option>
                      <option value="ADD">Add</option>
                      <option value="UPDATE">Update</option>
                      <option value="DELETE">Delete</option>
                    </select>
                  </div>
          <div class="filter-group">
            <label for="adminLogDateRange">Date Range</label>
            <select id="adminLogDateRange" class="report-select">
              <option value="all">All Time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group" id="activityWeekGroup" style="display:none;min-width:200px;">
            <label for="activityWeekPicker" style="display:block;margin-bottom:6px;">Select Week</label>
            <input type="week" id="activityWeekPicker" class="report-select" />
          </div>
          <div class="filter-group" id="activityMonthGroup" style="display:none;min-width:200px;">
            <label for="activityMonthPicker" style="display:block;margin-bottom:6px;">Select Month</label>
            <input type="month" id="activityMonthPicker" class="report-select" />
          </div>
          <div class="filter-group" id="activityYearGroup" style="display:none;min-width:160px;">
            <label for="activityYearPicker" style="display:block;margin-bottom:6px;">Select Year</label>
            <input type="number" id="activityYearPicker" class="report-select" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          <div class="filter-group custom-date-inputs" style="display: none;">
            <label for="adminLogStartDate" style="display:block;margin-bottom:6px;">Start Date</label>
            <input type="date" id="adminLogStartDate" class="report-select" />
          </div>
          <div class="filter-group custom-date-inputs" style="display: none;">
            <label for="adminLogEndDate" style="display:block;margin-bottom:6px;">End Date</label>
            <input type="date" id="adminLogEndDate" class="report-select" />
          </div>
          <div class="filter-group">
            <label for="adminLogRecordsPerPage">Records per Page</label>
            <select id="adminLogRecordsPerPage" class="report-select" onchange="changeAdminLogRecordsPerPage(this.value)">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="filter-actions">
          <button class="filter-btn" id="adminLogFilterBtn">Filter</button>
          <button class="filter-btn export" id="adminLogDownloadExcel">Download Excel</button>
          <button class="filter-btn export" id="adminLogDownloadPDF">Download PDF</button>
        </div>
      </div>
      <div class="report-preview-area">
        <div class="report-preview-title">Admin Log</div>
        <table class="admin-log-table">
          <thead>
            <tr>
              <th>ADMIN</th>
              <th>ACTIVITY</th>
              <th>DATE/TIME</th>
              <th>DETAILS</th>
            </tr>
          </thead>
          <tbody id="adminLogTableBody">
            <!-- JS will render rows here -->
          </tbody>
        </table>
        <div id="adminLogPagination" class="pagination-container" style="display:none;">
          <!-- JS will render pagination here -->
        </div>
      </div>
    </div>
  </div>
</template>

<template id="feedbacks-template">
  <div class="feedbacks-container">
    <div class="feedbacks-header">
      <div>
        <h1>Feedback Dashboard</h1>
        <div class="feedbacks-subtitle">Manage customer feedback and support tickets</div>
      </div>
      <a href="#" class="feedbacks-tickets-link" id="feedbacksCountLink">0 feedbacks</a>
    </div>
    <div class="feedbacks-stats-row feedbacks-feedback-stats-row" style="display:grid;grid-template-columns:repeat(6,1fr);gap:16px;align-items:stretch;">
      <div class="feedbacks-stat-card feedbacks-stat-blue" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128172;</span>
        <div class="stat-label">Total</div>
        <div class="stat-value" id="feedbackTotalCount">0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-yellow" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#11088;</span>
        <div class="stat-label">Avg Rating</div>
        <div class="stat-value stat-rating" id="feedbackAvgRating">0.0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-green" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128515;</span>
        <div class="stat-label">Positive</div>
        <div class="stat-value" id="feedbackPositiveCount">0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-yellow" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128994;</span>
        <div class="stat-label">5 Stars</div>
        <div class="stat-value" id="feedbackFiveStarsCount">0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-red" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128196;</span>
        <div class="stat-label">Negative</div>
        <div class="stat-value" id="feedbackNegativeCount">0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-blue" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128337;</span>
        <div class="stat-label">Recent (3d)</div>
        <div class="stat-value" id="feedbackRecentCount">0</div>
      </div>
    </div>
    <div class="report-generator-card" style="padding:20px 24px;">
      <style>
        /* Feedback date picker styling to match admin log */
        .feedbacks-filters input[type="week"].report-select,
        .feedbacks-filters input[type="month"].report-select,
        .feedbacks-filters input[type="date"].report-select,
        .feedbacks-filters input[type="number"].report-select {
          background: #181f36;
          color: #fff;
          border: 1px solid #2a3b6d;
          border-radius: 6px;
          padding: 7px 12px;
          font-size: 1em;
          outline: none;
          width: 100%;
        }
        
        .feedbacks-filters input[type="week"].report-select:focus,
        .feedbacks-filters input[type="month"].report-select:focus,
        .feedbacks-filters input[type="date"].report-select:focus,
        .feedbacks-filters input[type="number"].report-select:focus {
          outline: none;
          border-color: #4a9eff;
          box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
        }
        
        /* Calendar picker indicators for feedback date inputs */
        .feedbacks-filters input[type="week"].report-select::-webkit-calendar-picker-indicator,
        .feedbacks-filters input[type="month"].report-select::-webkit-calendar-picker-indicator,
        .feedbacks-filters input[type="date"].report-select::-webkit-calendar-picker-indicator {
          filter: invert(1);
          cursor: pointer;
          opacity: 0.7;
          transition: opacity 0.3s ease;
        }
        
        .feedbacks-filters input[type="week"].report-select::-webkit-calendar-picker-indicator:hover,
        .feedbacks-filters input[type="month"].report-select::-webkit-calendar-picker-indicator:hover,
        .feedbacks-filters input[type="date"].report-select::-webkit-calendar-picker-indicator:hover {
          opacity: 1;
        }
        
        /* Remove number input spinners for year picker */
        .feedbacks-filters input[type="number"].report-select::-webkit-outer-spin-button,
        .feedbacks-filters input[type="number"].report-select::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        
        .feedbacks-filters input[type="number"].report-select {
          appearance: textfield; /* Standard */
          -moz-appearance: textfield; /* Firefox */
        }
      </style>
      <div class="report-filters feedbacks-filters" style="margin-bottom:0;">
        <!-- Single Row: All Filters -->
        <div class="filter-row" style="display:flex; gap:20px; align-items:flex-end; margin-bottom:16px; flex-wrap:wrap;">
          <div class="filter-group" style="min-width:160px;">
            <label for="feedback-search" style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">🔍 Name Search</label>
            <input type="text" id="feedback-search" class="feedbacks-search-input" placeholder="Search feedback name..." style="width:100%; padding:10px 12px; background:#1a2332; border:1px solid #2a3a4a; border-radius:6px; color:#e0e6f6; font-size:14px; outline:none; transition:border-color 0.2s;" onfocus="this.style.borderColor='#3b7bfa'" onblur="this.style.borderColor='#2a3a4a'" />
          </div>
          <div class="filter-group" style="min-width:140px;">
            <label for="feedbackDateRange" style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">📅 Date Range</label>
            <select id="feedbackDateRange" class="report-select">
              <option value="all">All Time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group" id="feedbackWeekGroup" style="display:none;min-width:200px; margin-right:8px;">
            <label for="feedbackWeekPicker" style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">📅 Select Week</label>
            <input type="week" id="feedbackWeekPicker" class="report-select" style="width:100%; padding:8px 12px;" />
          </div>
          <div class="filter-group" id="feedbackMonthGroup" style="display:none;min-width:200px; margin-right:8px;">
            <label for="feedbackMonthPicker" style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">📅 Select Month</label>
            <input type="month" id="feedbackMonthPicker" class="report-select" style="width:100%; padding:8px 12px;" />
          </div>
          <div class="filter-group" id="feedbackYearGroup" style="display:none;min-width:180px; margin-right:8px;">
            <label for="feedbackYearPicker" style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">📅 Select Year</label>
            <input type="number" id="feedbackYearPicker" class="report-select" min="1970" max="2100" step="1" placeholder="2025" style="width:100%; padding:8px 12px;" />
          </div>
          <div class="filter-group custom-date-inputs" id="feedbackCustomDateGroup" style="display:none;min-width:180px; margin-right:8px;">
            <label for="feedback-date-from" style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">📅 Start Date</label>
            <input type="date" id="feedback-date-from" class="report-select" style="width:100%; padding:8px 12px;" />
          </div>
          <div class="filter-group custom-date-inputs" style="display:none;min-width:180px; margin-right:8px;">
            <label for="feedback-date-to" style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">📅 End Date</label>
            <input type="date" id="feedback-date-to" class="report-select" style="width:100%; padding:8px 12px;" />
          </div>
          <div class="filter-group" style="min-width:120px;">
            <label style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">⭐ Star Rating</label>
            <select class="report-select" id="feedbackStarRatingFilter">
              <option value="">All Ratings</option>
              <option value="5">5 Stars</option>
              <option value="4">4 Stars</option>
              <option value="3">3 Stars</option>
              <option value="2">2 Stars</option>
              <option value="1">1 Star</option>
            </select>
          </div>
          <div class="filter-group" style="min-width:120px;">
            <label style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">😊 Sentiment</label>
            <select class="report-select" id="feedbackSentimentFilter">
              <option value="">All Sentiment</option>
              <option value="Positive">Positive</option>
              <option value="Negative">Negative</option>
              <option value="Neutral">Neutral</option>
            </select>
          </div>
          <div class="filter-group" style="min-width:120px;">
            <label style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">🚨 Priority</label>
            <select class="report-select" id="feedbackPriorityFilter">
              <option value="">All Priorities</option>
              <option value="Critical">Critical</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>
          </div>
          <div class="filter-group" style="min-width:120px;">
            <label style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">📋 Status</label>
            <select class="report-select" id="feedbackStatusFilter">
              <option value="">All Status</option>
              <option value="Open">Open</option>
              <option value="In Progress">In Progress</option>
              <option value="Resolved">Resolved</option>
              <option value="Closed">Closed</option>
            </select>
          </div>
          <div class="filter-group" style="min-width:120px;">
            <label for="feedbackRecordsPerPage" style="display:block; color:#bfc9da; margin-bottom:6px; font-weight:500; font-size:13px;">📄 Records per Page</label>
            <select id="feedbackRecordsPerPage" class="report-select">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>

        <!-- Action Buttons Row -->
        <div class="filter-actions" style="display:flex; gap:16px; align-items:flex-end; justify-content:flex-end; padding-top:8px; border-top:1px solid #2a3a4a;">
          <button class="filter-btn" id="applyFeedbackFilters" type="button" style="background:linear-gradient(135deg, #3b7bfa 0%, #2d5fd8 100%); color:#fff; border:none; padding:10px 20px; border-radius:6px; font-weight:600; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:8px; min-width:120px; height:42px;" onmouseover="this.style.background='linear-gradient(135deg, #2d5fd8 0%, #1e40af 100%)'" onmouseout="this.style.background='linear-gradient(135deg, #3b7bfa 0%, #2d5fd8 100%)'">
            <span>🔎</span> Filter
          </button>
          <button class="filter-btn export" id="export-feedbacks-excel" type="button" style="background:linear-gradient(135deg, #10b981 0%, #059669 100%); color:#fff; border:none; padding:10px 20px; border-radius:6px; font-weight:600; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:8px; min-width:140px; height:42px;" onmouseover="this.style.background='linear-gradient(135deg, #059669 0%, #047857 100%)'" onmouseout="this.style.background='linear-gradient(135deg, #10b981 0%, #059669 100%)'">
            <span>📊</span> Download Excel
          </button>
          <button class="filter-btn export" id="export-feedbacks-pdf" type="button" style="background:linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color:#fff; border:none; padding:10px 20px; border-radius:6px; font-weight:600; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:8px; min-width:140px; height:42px;" onmouseover="this.style.background='linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)'" onmouseout="this.style.background='linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'">
            <span>📄</span> Download PDF
          </button>
        </div>
      </div>
    </div>
    <div class="feedbacks-table-card">
      <table class="feedbacks-table">
        <thead>
          <tr>
            <th>FEEDBACK ID</th>
            <th>FEEDBACK TEXT</th>
            <th>FEEDBACK TYPE</th>
            <th>CUSTOMER NAME</th>
            <th>CUSTOMER EMAIL</th>
            <th>PRIORITY</th>
            <th>STAR RATE</th>
            <th>SENTIMENT</th>
            <th>STATUS</th>
            <th>ACTION</th>
          </tr>
        </thead>
        <tbody id="feedbacksTableBody">
          <!-- Data will be populated dynamically by JavaScript -->
        </tbody>
      </table>
      <div id="feedbacksPagination" class="pagination-container" style="display:none;">
        <div id="feedbacksPageInfo" class="pagination-info"></div>
        <div class="pagination-controls" id="feedbacksPageControls"></div>
      </div>
    </div>
  </div>
</template>

<!-- Device Management -->
<template id="device-management-template">
  <div class="device-management-container">
    <div class="device-management-header">
      <div>
        <h1>Device Management</h1>
        <div class="device-management-subtitle">Monitor and manage IoT devices, sensors, and equipment status across all users</div>
      </div>
      
    </div>
    
    <!-- KPI Cards -->
    <div class="device-management-stats-row">
      <div class="device-management-stat-card">
        <span class="stat-icon stat-blue">&#128187;</span>
        <div class="stat-label">Total Devices</div>
        <div class="stat-value" id="totalDevicesCount">0</div>
        <div class="stat-trend" id="totalDevicesTrend">↑ 0 sensors</div>
      </div>
      <div class="device-management-stat-card">
        <span class="stat-icon stat-green">&#128200;</span>
        <div class="stat-label">Active Devices</div>
        <div class="stat-value" id="activeDevicesManagementCount">0</div>
        <div class="stat-trend" id="activeDevicesTrend">↑ 0% online</div>
      </div>
      <div class="device-management-stat-card">
        <span class="stat-icon stat-orange">&#9200;</span>
        <div class="stat-label">Device Health</div>
        <div class="stat-value" id="deviceHealthPercent">0%</div>
        <div class="stat-trend" id="deviceHealthTrend">↑ All operational</div>
      </div>
      <div class="device-management-stat-card">
        <span class="stat-icon stat-red">&#9888;</span>
        <div class="stat-label">Alerts</div>
        <div class="stat-value" id="deviceAlertsCount">0</div>
        <div class="stat-trend" id="deviceAlertsTrend">↓ No issues</div>
      </div>
    </div>

    <!-- Main Content Cards -->
    <div class="device-management-main-cards">
      <!-- Device Status -->
      <div class="device-management-card">
        <div class="device-management-card-header">
          <h3>Device Activities</h3>
          <div class="device-management-card-actions">
            <button id="addDeviceBtn" class="device-management-btn-primary" style="margin-left:8px;">+ Add Device</button>
          </div>
        </div>
        <div class="device-filters-row">
          <div class="df-item df-wide">
            <label>Name Search</label>
            <input id="dfSearch" placeholder="Search device or user..." />
          </div>
          <div class="df-item">
            <label>Status</label>
            <select id="dfStatus">
              <option value="">All</option>
              <option value="ONLINE">ONLINE</option>
              <option value="OFFLINE">OFFLINE</option>
            </select>
          </div>
          
          <div class="df-item">
            <label>Records per Page</label>
            <select id="dfPageSize">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
          <div class="df-item df-actions">
            <label>&nbsp;</label>
            <div class="df-action-buttons">
              <button type="button" class="filter-btn" id="inlineApplyFilters">Filter</button>
              <button type="button" class="filter-btn export" id="downloadCsvBtn">Download CSV</button>
              <button type="button" class="filter-btn export" id="downloadPdfBtn">Download PDF</button>
            </div>
          </div>
        </div>
        
        <div class="device-management-table-container">
          <table class="device-management-table">
            <thead>
              <tr>
                <th>Device ID</th>
                <th>Device Name</th>
                <th>User</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="deviceActivitiesTableBody">
              <!-- Device status will be populated dynamically by JavaScript -->
            </tbody>
          </table>
        </div>
        <div class="device-pagination-row fancy">
          <div class="dp-left"><span id="dpRangeInfo" style="color:#bfc9da;">Showing 0 to 0 of 0 records</span></div>
          <div class="dp-right">
            <div id="dpNumbers" class="dp-numbers"></div>
            <button id="dpNext" class="device-management-filter-btn">Next ›</button>
          </div>
        </div>
      </div>

      
    </div>
  </div>
</template>

<!-- Device Details Modal -->
<div id="deviceDetailsModal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Device Details</h3>
      <span class="close" id="closeDeviceDetailsModal" style="cursor:pointer;">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-group"><label>Device ID</label><div id="ddmDeviceId"></div></div>
      <div class="form-group"><label>Device Name</label><div id="ddmDeviceName"></div></div>
      <div class="form-group"><label>Type</label><div id="ddmDeviceType"></div></div>
      <div class="form-group"><label>Status</label><div id="ddmDeviceStatus"></div></div>
      <div class="form-group"><label>User</label><div id="ddmUserName"></div></div>
      <div class="form-group"><label>User Email</label><div id="ddmUserEmail"></div></div>
      <div class="form-group"><label>Created At</label><div id="ddmCreatedAt"></div></div>
      <div class="form-group"><label>Last Update</label><div id="ddmLastUpdate"></div></div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" id="deviceDetailsCloseBtn">Close</button>
    </div>
  </div>
  <style>
    /* Reuse existing modal styling baseline */
    #deviceDetailsModal .modal-content { max-width: 480px; }
    #deviceDetailsModal .form-group { margin: 6px 0; }
    #deviceDetailsModal .form-group label { display:block;color:#bfc9da;margin-bottom:4px; }
    #deviceDetailsModal .form-group div { color:#fff;background:#181f36;padding:6px 8px;border-radius:6px;border:1px solid #2a3b6d; }
    
  </style>
</div>

<!-- Enhanced Confirm Modal -->
<div id="confirmModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:460px;">
    <div class="modal-header" style="padding: 24px 24px 20px 24px; background: linear-gradient(135deg, #1a2340 0%, #14224a 100%); border-radius: 8px 8px 0 0;">
      <div style="display: flex; align-items: center; gap: 16px;">
        <div id="confirmIcon" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(59, 123, 250, 0.15); border: 2px solid rgba(59, 123, 250, 0.3); display: flex; align-items: center; justify-content: center; font-size: 24px; backdrop-filter: blur(10px);">
          ⚠️
        </div>
        <div>
          <h3 id="confirmTitle" style="margin: 0; color: #fff; font-size: 18px; font-weight: 700;">Confirm Action</h3>
          <p style="margin: 4px 0 0 0; color: #bfc9da; font-size: 13px; font-weight: 400;">Please review the details below</p>
        </div>
      </div>
      <span class="close" id="confirmClose" style="cursor:pointer; color: #bfc9da; font-size: 20px; opacity: 0.7; transition: all 0.2s; padding: 8px; border-radius: 6px;" onmouseover="this.style.opacity='1'; this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.opacity='0.7'; this.style.background='transparent'">&times;</span>
    </div>
    <div class="modal-body" style="padding: 24px;">
      <div id="confirmMessage" style="color: #e0e6f6; line-height: 1.6; font-size: 15px; margin-bottom: 20px; font-weight: 500;"></div>
      <div id="confirmDetails" style="background: linear-gradient(135deg, #181f36 0%, #1a2340 100%); border-radius: 10px; padding: 18px; border: 1px solid #2a3b6d; position: relative; overflow: hidden;">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #3b7bfa 0%, #667eea 100%);"></div>
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
          <div style="width: 8px; height: 8px; border-radius: 50%; background: #3b7bfa; box-shadow: 0 0 8px rgba(59, 123, 250, 0.5);"></div>
          <span style="color: #3b7bfa; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Action Details</span>
        </div>
        <div id="confirmActionDetails" style="color: #e0e6f6; font-size: 14px; line-height: 1.5; font-weight: 400;"></div>
      </div>
    </div>
    <div class="modal-footer" style="display:flex;gap:12px;justify-content:flex-end;padding:20px 24px 24px 24px; background: #0f172a;">
      <button type="button" class="btn btn-secondary" id="confirmCancel" style="padding: 12px 24px; border-radius: 8px; font-weight: 600; transition: all 0.2s;">Cancel</button>
      <button type="button" class="btn btn-primary" id="confirmOk" style="padding: 12px 24px; border-radius: 8px; font-weight: 600; background: linear-gradient(135deg, #3b7bfa 0%, #2d5fd8 100%); border: none; box-shadow: 0 4px 12px rgba(59, 123, 250, 0.3); transition: all 0.2s;">Confirm</button>
    </div>
  </div>
</div>

<!-- Device Filters Modal -->
<div id="deviceFilterModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:560px;">
    <div class="modal-header">
      <h3>Filters</h3>
      <span class="close" id="deviceFilterClose" style="cursor:pointer;">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="form-group">
          <label>Type</label>
          <select id="filterType" style="width:100%;background:#181f36;color:#fff;border:1px solid #2a3b6d;border-radius:8px;padding:10px 12px;">
            <option value="">All</option>
            <option value="Temperature">Temperature</option>
            <option value="Humidity">Humidity</option>
            <option value="Gas">Gas</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="filterStatus" style="width:100%;background:#181f36;color:#fff;border:1px solid #2a3b6d;border-radius:8px;padding:10px 12px;">
            <option value="">All</option>
            <option value="ONLINE">ONLINE</option>
            <option value="OFFLINE">OFFLINE</option>
          </select>
        </div>
      </div>
      <div class="form-group"><label>User (username/email)</label>
        <input id="filterUser" placeholder="Search user..." style="width:100%;background:#181f36;color:#fff;border:1px solid #2a3b6d;border-radius:8px;padding:10px 12px;">
      </div>
    </div>
    <div class="modal-footer" style="display:flex;gap:8px;justify-content:flex-end;">
      <button type="button" class="btn btn-secondary" id="clearFilters">Clear</button>
      <button type="button" class="btn btn-primary" id="applyFilters">Apply</button>
    </div>
  </div>
  <style>
    #deviceFilterModal .modal-content { max-width: 560px; }
  </style>
</div>
<!-- Add Device Modal -->
    <!-- Enhanced Add Device Modal -->
    <style>
      #addDeviceModal input {
        background: #0f172a !important;
        color: #e0e6f6 !important;
        -webkit-text-fill-color: #e0e6f6 !important;
        -webkit-box-shadow: 0 0 0 1000px #0f172a inset !important;
        box-shadow: 0 0 0 1000px #0f172a inset !important;
      }
      #addDeviceModal input:focus {
        background: #0f172a !important;
        color: #e0e6f6 !important;
        -webkit-text-fill-color: #e0e6f6 !important;
        -webkit-box-shadow: 0 0 0 1000px #0f172a inset !important;
        box-shadow: 0 0 0 1000px #0f172a inset !important;
      }
      #addDeviceModal input::placeholder {
        color: #64748b !important;
        -webkit-text-fill-color: #64748b !important;
      }
    </style>
    <div id="addDeviceModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:520px;">
    <div class="modal-header" style="padding: 24px 24px 20px 24px; background: linear-gradient(135deg, #1a2340 0%, #14224a 100%); border-radius: 12px 12px 0 0;">
      <div style="display: flex; align-items: center; gap: 16px;">
        <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(59, 123, 250, 0.15); border: 2px solid rgba(59, 123, 250, 0.3); display: flex; align-items: center; justify-content: center; font-size: 24px; backdrop-filter: blur(10px);">
          ➕
        </div>
        <div>
          <h3 style="margin: 0; color: #fff; font-size: 18px; font-weight: 700;">Add Device</h3>
          <p style="margin: 4px 0 0 0; color: #bfc9da; font-size: 13px; font-weight: 400;">Configure new sensor device for user</p>
        </div>
      </div>
      <span class="close" id="addDeviceClose" style="cursor:pointer; color: #bfc9da; font-size: 20px; opacity: 0.7; transition: all 0.2s; padding: 8px; border-radius: 6px;" onmouseover="this.style.opacity='1'; this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.opacity='0.7'; this.style.background='transparent'">&times;</span>
    </div>
    <div class="modal-body" style="padding: 24px;">
      <div style="background: linear-gradient(135deg, #181f36 0%, #1a2340 100%); border-radius: 10px; padding: 20px; border: 1px solid #2a3b6d; position: relative; overflow: hidden; margin-bottom: 20px;">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #3b7bfa 0%, #667eea 100%);"></div>
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
          <div style="width: 8px; height: 8px; border-radius: 50%; background: #3b7bfa; box-shadow: 0 0 8px rgba(59, 123, 250, 0.5);"></div>
          <span style="color: #3b7bfa; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Sensor Configuration</span>
        </div>
        
        <div style="display: grid; gap: 16px; max-width: 400px;">
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; color: #e0e6f6; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
              <span style="width: 20px; height: 20px; border-radius: 6px; background: rgba(255, 107, 107, 0.2); display: flex; align-items: center; justify-content: center; font-size: 12px;">🌡️</span>
              <span>Temperature Sensor ID</span>
            </label>
            <input id="tempSensorId" placeholder="Enter temperature sensor ID" style="width: 100%; background: #0f172a !important; color: #e0e6f6 !important; border: 1px solid #2a3b6d; border-radius: 8px; padding: 12px 14px; font-size: 14px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#3b7bfa'; this.style.color='#e0e6f6';" onblur="this.style.borderColor='#2a3b6d'; this.style.color='#e0e6f6';">
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; color: #e0e6f6; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
              <span style="width: 20px; height: 20px; border-radius: 6px; background: rgba(107, 193, 255, 0.2); display: flex; align-items: center; justify-content: center; font-size: 12px;">💧</span>
              <span>Humidity Sensor ID</span>
            </label>
            <input id="humSensorId" placeholder="Enter humidity sensor ID" style="width: 100%; background: #0f172a !important; color: #e0e6f6 !important; border: 1px solid #2a3b6d; border-radius: 8px; padding: 12px 14px; font-size: 14px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#3b7bfa'; this.style.color='#e0e6f6';" onblur="this.style.borderColor='#2a3b6d'; this.style.color='#e0e6f6';">
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; color: #e0e6f6; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
              <span style="width: 20px; height: 20px; border-radius: 6px; background: rgba(255, 209, 102, 0.2); display: flex; align-items: center; justify-content: center; font-size: 12px;">⚡</span>
              <span>Gas Sensor ID</span>
            </label>
            <input id="gasSensorId" placeholder="Enter gas sensor ID" style="width: 100%; background: #0f172a !important; color: #e0e6f6 !important; border: 1px solid #2a3b6d; border-radius: 8px; padding: 12px 14px; font-size: 14px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#3b7bfa'; this.style.color='#e0e6f6';" onblur="this.style.borderColor='#2a3b6d'; this.style.color='#e0e6f6';">
          </div>
        </div>
      </div>
      
      <div class="form-group" style="max-width: 400px;">
        <label style="display: flex; align-items: center; gap: 10px; color: #e0e6f6; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
          <span style="width: 20px; height: 20px; border-radius: 6px; background: rgba(59, 123, 250, 0.2); display: flex; align-items: center; justify-content: center; font-size: 12px;">👤</span>
          <span>User Account</span>
        </label>
        <input id="adAccount" placeholder="Enter user email address" style="width: 100%; background: #0f172a !important; color: #e0e6f6 !important; border: 1px solid #2a3b6d; border-radius: 8px; padding: 12px 14px; font-size: 14px; outline: none; transition: border-color 0.2s; -webkit-text-fill-color: #e0e6f6 !important; -webkit-box-shadow: 0 0 0 1000px #0f172a inset !important; box-shadow: 0 0 0 1000px #0f172a inset !important;" onfocus="this.style.borderColor='#3b7bfa'; this.style.color='#e0e6f6'; this.style.webkitTextFillColor='#e0e6f6';" onblur="this.style.borderColor='#2a3b6d'; this.style.color='#e0e6f6'; this.style.webkitTextFillColor='#e0e6f6';" oninput="this.style.color='#e0e6f6'; this.style.webkitTextFillColor='#e0e6f6';">
      </div>
    </div>
    <div class="modal-footer" style="display:flex;gap:12px;justify-content:flex-end;padding:20px 24px 24px 24px; background: #0f172a;">
      <button type="button" class="btn btn-secondary" id="addDeviceCancel" style="padding: 12px 24px; border-radius: 8px; font-weight: 600; transition: all 0.2s;">Cancel</button>
      <button type="button" class="btn btn-primary" id="addDeviceSave" style="padding: 12px 24px; border-radius: 8px; font-weight: 600; background: linear-gradient(135deg, #3b7bfa 0%, #2d5fd8 100%); border: none; box-shadow: 0 4px 12px rgba(59, 123, 250, 0.3); transition: all 0.2s;">Add Device</button>
    </div>
  </div>
</div>

<!-- ML Training Data Modal -->
<div id="mlTrainingDataModal" class="modal" style="display: none;">
  <div class="update-modal">
    <div class="update-modal-header">
      <h3 class="update-modal-title">
        <span class="update-modal-icon">📊</span>
        Add Training Data
      </h3>
      <span class="update-modal-close" id="closeMlTrainingModal">&times;</span>
    </div>
    <div class="update-modal-body">
      <div class="update-modal-info">
        <p class="update-modal-info-text">
          <span class="update-modal-info-icon">ℹ️</span>
          Enter the details for the new training data sample to improve ML predictions.
        </p>
      </div>
      
      <form id="mlTrainingDataForm">
        <!-- Food Information Section -->
        <div class="update-modal-section">
          <h4 class="update-modal-section-title">
            <span>🍎</span> Food Information
          </h4>
          <div class="update-modal-form-row">
            <div class="update-modal-form-group">
              <label for="mlFoodName" class="update-modal-label">Food Name</label>
              <input type="text" id="mlFoodName" name="foodName" placeholder="e.g., Banana" required class="update-modal-input">
            </div>
            <div class="update-modal-form-group">
              <label for="mlCategory" class="update-modal-label">Category</label>
              <input type="text" id="mlCategory" name="category" placeholder="e.g., Fruits" required class="update-modal-input">
            </div>
          </div>
        </div>
        
        <!-- Environmental Conditions Section -->
        <div class="update-modal-section">
          <h4 class="update-modal-section-title">
            <span>🌡️</span> Environmental Conditions
          </h4>
          <div class="update-modal-form-row-three">
            <div class="update-modal-form-group">
              <label for="mlTemperature" class="update-modal-label">🌡️ Temp (°C)</label>
              <input type="number" id="mlTemperature" name="temperature" placeholder="25.0" step="0.1" required class="update-modal-input">
            </div>
            <div class="update-modal-form-group">
              <label for="mlHumidity" class="update-modal-label">💧 Humidity (%)</label>
              <input type="number" id="mlHumidity" name="humidity" placeholder="50.0" step="0.1" required class="update-modal-input">
            </div>
            <div class="update-modal-form-group">
              <label for="mlPh" class="update-modal-label">💨 Gas (ppm)</label>
              <input type="number" id="mlPh" name="ph" placeholder="100.0" step="0.1" required class="update-modal-input">
            </div>
          </div>
        </div>
        
        <!-- Status & Quality Section -->
        <div class="update-modal-section">
          <h4 class="update-modal-section-title">
            <span>📋</span> Status & Quality
          </h4>
          <div class="update-modal-form-row">
            <div class="update-modal-form-group">
              <label for="mlActualStatus" class="update-modal-label">Actual Status</label>
              <select id="mlActualStatus" name="actualStatus" required class="update-modal-select">
                <option value="" class="update-modal-option">Select status</option>
                <option value="safe" class="update-modal-option safe">✅ Safe</option>
                <option value="caution" class="update-modal-option caution">⚠️ Caution</option>
                <option value="unsafe" class="update-modal-option unsafe">❌ Unsafe</option>
              </select>
            </div>
            <div class="update-modal-form-group">
              <label for="mlSource" class="update-modal-label">Data Source</label>
              <select id="mlSource" name="source" required class="update-modal-select">
                <option value="" class="update-modal-option">Select source</option>
                <option value="manual" class="update-modal-option">✋ Manual</option>
                <option value="sensor" class="update-modal-option">📡 Sensor</option>
                <option value="user_feedback" class="update-modal-option">💬 User Feedback</option>
                <option value="expert" class="update-modal-option">🎓 Expert</option>
              </select>
            </div>
          </div>
          <div class="update-modal-form-group">
            <label for="mlDataQuality" class="update-modal-label">Data Quality (%)</label>
            <input type="number" id="mlDataQuality" name="dataQuality" placeholder="95" min="0" max="100" step="1" required class="update-modal-input">
          </div>
        </div>
        
        <!-- Environmental Factors Section -->
        <div class="update-modal-section">
          <h4 class="update-modal-section-title">
            <span>🌍</span> Environmental Factors
          </h4>
          <div class="update-modal-form-group">
            <label for="mlEnvironmentalFactors" class="update-modal-label">Additional Environmental Data (JSON)</label>
            <textarea id="mlEnvironmentalFactors" name="environmentalFactors" placeholder='{"notes": "Additional observations", "location": "Storage area", "conditions": "Normal"}' rows="3" class="update-modal-textarea"></textarea>
          </div>
        </div>
      </form>
    </div>
    <div class="update-modal-footer">
      <button type="button" class="update-modal-btn update-modal-btn-secondary" id="cancelMlTrainingBtn">Cancel</button>
      <button type="button" class="update-modal-btn update-modal-btn-primary" id="addMlTrainingDataBtn">Add Training Data</button>
    </div>
  </div>
</div>

<!-- Response Modal -->
<div id="responseModal" class="modal" style="display: none;" onclick="if(event.target === this) closeResponseModal()">
  <div class="modal-content" style="max-width: 650px; background: #0f172a; border: 1px solid #1f2a46; border-radius: 12px; box-shadow: 0 20px 40px rgba(0,0,0,0.4); overflow: hidden;" onclick="event.stopPropagation()">
    <div class="modal-header" style="display: flex; align-items: center; justify-content: space-between; border-bottom: none; padding: 24px 24px 20px 24px; background: linear-gradient(135deg, #1a2340 0%, #14224a 100%); border-radius: 12px 12px 0 0;">
      <h3 style="color: #fff; margin: 0; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 20px;">💬</span>
        Respond to Feedback
      </h3>
      <span class="close" onclick="closeResponseModal()" style="color: #bfc9da; font-size: 24px; font-weight: bold; cursor: pointer; transition: all 0.2s; line-height: 1; padding: 4px; border-radius: 4px;" onmouseover="this.style.color='#fff'; this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.color='#bfc9da'; this.style.background='transparent'">&times;</span>
    </div>
    <div class="modal-body" style="color: #e0e6f6; padding: 24px; background: #0f172a;">
      <div class="feedback-details" style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, #1a2332 0%, #212c4d 100%); border-radius: 8px; border: 1px solid #2a3a4a;">
        <h4 style="color: #4a9eff; margin: 0 0 12px 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 14px;">📝</span>
          Feedback Details
        </h4>
        <div id="modalFeedbackText" class="feedback-text" style="background: #0f1419; border: 1px solid #2a3a4a; border-radius: 6px; padding: 16px; margin-bottom: 12px; color: #e0e6f6; line-height: 1.6; min-height: 60px; white-space: pre-wrap; word-wrap: break-word;"></div>
        <div class="feedback-info" style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 14px; color: #bfc9da;">
          <span id="modalCustomerName" style="background: #1e2a4f; padding: 4px 8px; border-radius: 4px; border: 1px solid #2b3a66;"></span>
          <span id="modalFeedbackType" style="background: #1e2a4f; padding: 4px 8px; border-radius: 4px; border: 1px solid #2b3a66;"></span>
          <span id="modalPriority" style="background: #1e2a4f; padding: 4px 8px; border-radius: 4px; border: 1px solid #2b3a66;"></span>
        </div>
      </div>
      
      <div class="form-group" style="margin-bottom: 20px;">
        <label for="responseStatus" style="display: block; color: #bfc9da; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Status:</label>
        <select id="responseStatus" class="form-control" style="width: 100%; background: #1a2332; border: 1px solid #2a3a4a; color: #e0e6f6; padding: 12px; border-radius: 6px; font-size: 14px; outline: none; transition: border-color 0.2s;" onfocus="this.style.borderColor='#3b7bfa'" onblur="this.style.borderColor='#2a3a4a'">
          <option value="Active">🕐 Active</option>
          <option value="Resolved">✅ Resolved</option>
          <option value="Archived">📁 Archived</option>
        </select>
      </div>
      
      <div class="form-group" style="margin-bottom: 20px;">
        <label style="display: block; color: #bfc9da; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Current Response to Customer:</label>
        <div id="currentResponseText" class="current-response-display" style="background: #0f1419; border: 1px solid #2a3a4a; border-radius: 6px; padding: 16px; min-height: 80px; color: #bfc9da; font-style: italic; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; position: relative;">
          <div style="position: absolute; top: 8px; right: 12px; font-size: 12px; color: #6b7280;">📋</div>
          No response sent yet
        </div>
      </div>
      
      <div class="form-group" style="margin-bottom: 0;">
        <label for="responseText" style="display: block; color: #bfc9da; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Response to Customer:</label>
        <textarea id="responseText" class="form-control" placeholder="Type your response to the customer..." style="width: 100%; background: #1a2332; border: 1px solid #2a3a4a; color: #e0e6f6; padding: 12px; border-radius: 6px; font-size: 14px; outline: none; transition: border-color 0.2s; resize: vertical; min-height: 100px; font-family: inherit; line-height: 1.5;" onfocus="this.style.borderColor='#3b7bfa'" onblur="this.style.borderColor='#2a3a4a'"></textarea>
      </div>
    </div>
    <div class="modal-footer" style="border-top: 1px solid #1f2a46; padding: 20px 24px 24px 24px; display: flex; gap: 12px; justify-content: flex-end; background: #0f172a;">
      <button type="button" class="btn btn-secondary" onclick="closeResponseModal()" style="background: transparent; border: 1px solid #2a3b6d; color: #e0e6f6; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='#1a2340'; this.style.borderColor='#3b7bfa'; this.style.color='#fff'" onmouseout="this.style.background='transparent'; this.style.borderColor='#2a3b6d'; this.style.color='#e0e6f6'">Cancel</button>
      <button type="button" class="btn btn-primary" onclick="saveResponse()" style="background: #3b7bfa; border: 1px solid #3b7bfa; color: #fff; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; gap: 8px;" onmouseover="this.style.background='#2d5fd8'; this.style.borderColor='#2d5fd8'" onmouseout="this.style.background='#3b7bfa'; this.style.borderColor='#3b7bfa'">
        <span>💾</span>
        Save Response
      </button>
    </div>
  </div>
</div>

<!-- Admin Account Details Modal -->
<div class="user-modal" id="adminAccountModal" style="display:none;z-index:2000;">
  <div class="user-modal-content" style="max-width: 500px; width: 90%;">
    <h2>Admin Account Details</h2>
    <form id="adminAccountForm">
      <div id="adminUpdateNotice" class="sb-notice" style="display:none; margin-bottom:10px;"></div>
      <input type="hidden" id="adminAccountId" />
      
      <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
        <div class="form-group" style="flex: 1;">
          <label for="adminEmail">Account (Email) *</label>
          <input type="email" id="adminEmail" required placeholder="admin@example.com" autocomplete="off" />
        </div>
        <div class="form-group" style="flex: 1;">
          <label for="adminUsername">Username</label>
          <input type="text" id="adminUsername" placeholder="Enter username" autocomplete="off" />
        </div>
      </div>

      <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
        <div class="form-group" style="flex: 1;">
          <label for="adminFirstName">First Name *</label>
          <input type="text" id="adminFirstName" required placeholder="First name" autocomplete="off" />
        </div>
        <div class="form-group" style="flex: 1;">
          <label for="adminLastName">Last Name *</label>
          <input type="text" id="adminLastName" required placeholder="Last name" autocomplete="off" />
        </div>
      </div>

      <div class="form-group" style="margin-bottom: 15px;">
        <label for="adminPassword">Create New Password</label>
        <input type="text" id="adminPassword" placeholder="Create new password (optional)" />
      </div>

      <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
        <div class="form-group" style="flex: 1;">
          <label for="adminRole">Role</label>
          <input type="text" id="adminRole" value="Admin" readonly />
        </div>
        <div class="form-group" style="flex: 1;">
          <label for="adminPhone">Phone</label>
          <input type="tel" id="adminPhone" placeholder="+1 555-123-4567" />
        </div>
      </div>

      <div class="form-group" style="margin-bottom: 20px;">
        <label for="adminCreated">Created At</label>
        <input type="text" id="adminCreated" readonly />
      </div>

      <div class="modal-actions" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
        <button type="submit" class="filter-btn" style="background: #4a5b8d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">Save</button>
        <button type="button" class="filter-btn export" id="cancelAdminAccountBtn" style="background: #2a3b6d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script src="../assets/js/config/api-config.js"></script>
<script src="../assets/js/Admin/sidebarexpand.js"></script>
<script src="../assets/js/Admin/analyticstat.js"></script>
<script src="../assets/js/Admin/ad-chart.js"></script>
<script src="../assets/js/Admin/Sensoranalytic.js"></script>
<script src="../assets/js/Admin/sensor-analytics-connector.js"></script>
<script src="../assets/js/Admin/spa.js"></script>
<script src="../assets/js/Admin/report-generator.js"></script>
<script src="../assets/js/Admin/user.js"></script>
<script src="../assets/js/Admin/user-activity-log.js"></script>
<script src="../assets/js/Admin/admin-log.js"></script>
<!-- <script src="../assets/js/Admin/account-modal.js"></script> --> <!-- Replaced with new admin account modal -->
<!-- Initialize all dashboard charts -->

<script>
// Initialize dashboard with real data when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Wait for the dashboard to be loaded by SPA
  setTimeout(() => {
    if (window.fetchDashboardStats) {
      window.fetchDashboardStats();
    }
  }, 1000);
});

function handleAdminPassFormSubmit(e) {
  e.preventDefault();
  const input = document.getElementById('adminPassInput');
  if (input.value === ADMIN_PASSWORD) {
    closeAdminPassModal();
    setTimeout(() => {
      if (pendingUserAction) {
        if (pendingUserAction.type === 'add') {
          // Use the new admin password modal system
          showAdminPasswordModal('add', () => {
            openUserModal();
            const nameInput = document.getElementById('userFirstName');
            if (nameInput) nameInput.focus();
          });
        }
        if (pendingUserAction.type === 'edit') {
          // Use the new admin password modal system
          showAdminPasswordModal('update', () => {
            openUserModal(pendingUserAction.user);
            const nameInput = document.getElementById('userFirstName');
            if (nameInput) nameInput.focus();
          });
        }
      }
    }, 100);
  } else {
    input.value = '';
    input.placeholder = 'Incorrect password';
    input.classList.add('error');
    setTimeout(() => { input.placeholder = ''; input.classList.remove('error'); }, 1200);
  }
}
</script>

<!-- Old Admin Account Modal - Replaced with new one in template -->
<!--
<div id="accountModal" class="account-modal" style="display:none;">
  <div class="account-modal-content">
    <span class="account-modal-close" id="accountModalClose">&times;</span>
    <h2>Admin Account Details</h2>
    <form id="accountModalForm">
      <div class="account-form-group">
        <label for="account-username">Account (Email/Username)</label>
        <input type="text" id="account-username" name="account-username" required>
      </div>
      <div class="account-form-group">
        <label for="account-name">Name</label>
        <input type="text" id="account-name" name="account-name" required>
      </div>
      <div class="account-form-group">
        <label for="account-password">Password</label>
        <input type="password" id="account-password" name="account-password" required>
      </div>
      <div class="account-form-group">
        <label for="account-role">Role</label>
        <input type="text" id="account-role" name="account-role" value="Admin" readonly>
      </div>
      <div class="account-form-group">
        <label for="account-phone">Phone</label>
        <input type="text" id="account-phone" name="account-phone">
      </div>
      <div class="account-form-group">
        <label for="account-created">Created</label>
        <input type="text" id="account-created" name="account-created" readonly>
      </div>
      <div class="account-modal-actions">
        <button type="submit" class="account-modal-save">Save</button>
        <button type="button" class="account-modal-cancel" id="accountModalCancel">Cancel</button>
      </div>
    </form>
  </div>
</div>
-->

<!-- Admin Logout Logic -->
<script>
(function() {
  // Prevent event bubbling from logout button to parent (which may open modal)
  var logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', function(e) {
      e.stopPropagation(); // Prevent parent click events
      
      // Get JWT token from multiple possible locations
      const jwtToken = localStorage.getItem('jwt_token') || 
                       localStorage.getItem('sessionToken') || 
                       localStorage.getItem('session_token');
      
      if (jwtToken) {
        // Call backend logout API to log the activity
        fetch('/api/auth/logout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${jwtToken}`
          }
        })
        .then(response => response.json())
        .then(data => {
          // Clear all session/user data regardless of API response
          clearAllStorage();
          
          // Show logout message (toast)
          showLogoutToast('Logging out...');
          setTimeout(() => {
            window.location.href = '/admin-login';
          }, 1200);
        })
        .catch(error => {
          console.error('Logout API error:', error);
          // Still logout even if API fails
          clearAllStorage();
          
          showLogoutToast('Logging out...');
          setTimeout(() => {
            window.location.href = '/admin-login';
          }, 1200);
        });
      } else {
        // Fallback if no token
        clearAllStorage();
        
        showLogoutToast('Logging out...');
        setTimeout(() => {
          window.location.href = '/admin-login';
        }, 1200);
      }
      
      // Helper function to clear all storage
      function clearAllStorage() {
        localStorage.removeItem('jwt_token');
        localStorage.removeItem('user_data');
        localStorage.removeItem('session_token');
        localStorage.removeItem('currentUser');
        localStorage.removeItem('currentAdmin');
        localStorage.removeItem('admin_data');
        localStorage.removeItem('sessionToken');
        localStorage.removeItem('sessionExpires');
        sessionStorage.clear();
      }
      
      // Helper function to show logout toast
      function showLogoutToast(message) {
        var toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #4caf50;
          color: white;
          padding: 15px 20px;
          border-radius: 8px;
          z-index: 10000;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        `;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => {
          if (toast.parentNode) toast.parentNode.removeChild(toast);
        }, 1200);
      }
    });
  }
})();
</script>

<!-- Feedbacks JavaScript -->
<script src="../assets/js/Admin/feedbacks.js"></script>
<!-- Device Management JavaScript -->
<script src="../assets/js/Admin/device-management.js"></script>

<!-- Admin Activity Logging Helper -->
<script>
(function() {
  function getAuthToken() {
    return localStorage.getItem('jwt_token') || localStorage.getItem('sessionToken') || localStorage.getItem('session_token') || '';
  }

  function buildAdminDetails(context) {
    try {
      if (!context) return '';
      // Normalize known contexts into concise descriptions
      const page = (context.page || '').trim();
      const target = (context.target || '').trim();
      const extra = (context.extra || '').trim();
      if (context.action === 'LOGIN') return 'Logged in';
      if (context.action === 'LOGOUT') return 'Logged out';
      if (context.action === 'ADD') {
        if (page === 'users') return 'Added: User';
        if (page === 'devices') return 'Added: Device';
        return 'Added';
      }
      if (context.action === 'UPDATE') {
        if (page === 'analytics') return 'Updated: on Analytics Filters';
        if (page === 'devices' && target === 'filters') return 'Updated: on Device Management Filters';
        if (page === 'users' && target === 'filters') return 'Updated: on Users Filters';
        if (target) return `Updated: ${target}`;
        return 'Updated';
      }
      if (context.action === 'DELETE') {
        if (page === 'users') return 'Deleted: User';
        if (page === 'devices') return 'Deactivated: Device';
        return 'Deleted';
      }
      return extra || '';
    } catch(_) { return ''; }
  }

  async function logAdminActivity(action, details) {
    // Disabled client-side POST to avoid 404 noise; rely on backend middleware/route-specific logs
    return;
  }

  // Expose globally for other modules
  window.logAdminActivity = logAdminActivity;

  // Wire common actions
  document.addEventListener('DOMContentLoaded', function() {
    // Logout button
    var logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function() {
        logAdminActivity('LOGOUT', { page: 'account' });
      });
    }

    // Add user
    var addUserBtn = document.getElementById('addUserBtn');
    // Do not log opening of Add User modal

    // Add device save button in template
    var addDeviceSave = document.getElementById('addDeviceSave');
    if (addDeviceSave) {
      addDeviceSave.addEventListener('click', function() {
        logAdminActivity('ADD', { page: 'devices' });
      });
    }

    // Filters apply (treat as UPDATE)
    // Intentionally do not log filter apply actions per requirement

    // Generic delegation for ADD/UPDATE/DELETE buttons
    document.body.addEventListener('click', function(e) {
      var el = e.target.closest('button, a');
      if (!el) return;
      var txt = (el.textContent || '').toLowerCase();
      if (txt.includes('delete') || txt.includes('deactivate') || el.classList.contains('delete') || el.classList.contains('deactivate') || el.id.toLowerCase().includes('delete') || el.id.toLowerCase().includes('deactivate')) {
        logAdminActivity('DELETE', { page: 'devices' });
      } else if (txt.includes('add') || txt.startsWith('+') || el.classList.contains('add') || el.id.toLowerCase().includes('add')) {
        // Try to infer context
        const inUsers = !!document.getElementById('users-template') && !!document.getElementById('userModal');
        logAdminActivity('ADD', { page: inUsers ? 'users' : 'devices' });
      } else if (
        txt.includes('save') ||
        txt.includes('update') ||
        txt.includes('edit') ||
        el.classList.contains('save') ||
        el.classList.contains('edit') ||
        el.id.toLowerCase().includes('save') ||
        el.id.toLowerCase().includes('update') ||
        el.id.toLowerCase().includes('edit')
      ) {
        logAdminActivity('UPDATE', { page: 'devices' });
      }
    });
  });
})();
</script>

<!-- Admin Password Modal for User Management -->
<div id="adminPasswordModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
  <div class="modal-content" style="background-color: #212c4d; margin: auto; padding: 0; border-radius: 12px; width: 90%; max-width: 450px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
    <div class="modal-header" style="padding: 20px 24px; border-bottom: 1px solid #2a3b6d; display: flex; align-items: center; justify-content: space-between;">
      <h3 style="color: #e0e6f6; margin: 0; font-size: 18px; font-weight: 600;">🔐 Admin Authentication</h3>
      <button onclick="closeAdminPasswordModal()" style="background: none; border: none; color: #bfc9da; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
    </div>
    
    <div class="modal-body" style="padding: 24px;">
      <div style="margin-bottom: 20px;">
        <div style="color: #bfc9da; font-size: 14px; margin-bottom: 8px;">Action Required</div>
        <div style="color: #e0e6f6; font-size: 16px; font-weight: 500;" id="adminPasswordAction">-</div>
      </div>
      
        <div style="margin-bottom: 20px;">
          <label style="color: #bfc9da; font-size: 14px; margin-bottom: 8px; display: block; font-weight: 500;">Enter your password</label>
          <div style="position: relative;">
            <input type="password" id="adminPasswordInput" autocomplete="current-password" style="width: 100%; padding: 12px 16px; background: #181f36; border: 1px solid #2a3b6d; border-radius: 6px; color: #e0e6f6; font-size: 14px; outline: none; transition: all 0.2s ease; box-sizing: border-box;" placeholder="Enter admin password..." onkeypress="handleAdminPasswordKeypress(event)" onfocus="this.style.borderColor='#4a9eff'; this.style.boxShadow='0 0 0 2px rgba(74, 158, 255, 0.2)'" onblur="this.style.borderColor='#2a3b6d'; this.style.boxShadow='none'">
            <button type="button" id="toggleAdminPassword" onclick="toggleAdminPasswordVisibility()" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #bfc9da; cursor: pointer; padding: 4px; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#2a3b6d'" onmouseout="this.style.backgroundColor='transparent'">
              <span id="toggleAdminPasswordIcon">👁️</span>
            </button>
            <!-- Password verification status indicator -->
            <div id="passwordStatusIndicator" style="position: absolute; right: 50px; top: 50%; transform: translateY(-50%); display: none; color: #4a9eff; font-size: 16px;">
              <span id="passwordStatusIcon">⏳</span>
            </div>
          </div>
          <!-- Password verification status message -->
          <div id="passwordStatusMessage" style="margin-top: 8px; font-size: 12px; color: #bfc9da; display: none;">
            <span id="passwordStatusText"></span>
          </div>
        </div>
      
      <div style="display: flex; gap: 12px; justify-content: flex-end;">
        <button onclick="closeAdminPasswordModal()" style="background: #2a3b6d; color: #e0e6f6; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">Cancel</button>
        <button onclick="submitAdminPassword()" style="background: #4a9eff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">Verify</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Notification Container -->
<div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px;"></div>

<!-- User Confirmation Modal -->
<div id="userConfirmModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
  <div class="modal-content" style="background-color: #212c4d; margin: auto; padding: 0; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
    <div class="modal-header" style="padding: 20px 24px; border-bottom: 1px solid #2a3b6d; display: flex; align-items: center; justify-content: space-between;">
      <h3 style="color: #e0e6f6; margin: 0; font-size: 18px; font-weight: 600;">⚠️ Confirm Action</h3>
      <button onclick="closeUserConfirmModal()" style="background: none; border: none; color: #bfc9da; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
    </div>
    
    <div class="modal-body" style="padding: 24px;">
      <div style="margin-bottom: 20px;">
        <div style="color: #e0e6f6; font-size: 16px; font-weight: 500;" id="userConfirmMessage">Are you sure you want to perform this action?</div>
      </div>
      
      <div style="display: flex; gap: 12px; justify-content: flex-end;">
        <button onclick="closeUserConfirmModal()" style="background: #2a3b6d; color: #e0e6f6; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">Cancel</button>
        <button onclick="confirmUserAction()" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">Confirm</button>
      </div>
    </div>
  </div>
</div>


<script>
// Admin Password Modal Functions
let currentAdminAction = null;
let currentAdminCallback = null;

// User Confirmation Modal Functions
let currentUserConfirmCallback = null;

function showUserConfirmModal(message, callback) {
  console.log('🔔 showUserConfirmModal called with message:', message);
  currentUserConfirmCallback = callback;
  
  const modal = document.getElementById('userConfirmModal');
  const messageElement = document.getElementById('userConfirmMessage');
  
  if (modal && messageElement) {
    messageElement.textContent = message;
    modal.style.display = 'flex';
  }
}

function closeUserConfirmModal() {
  const modal = document.getElementById('userConfirmModal');
  if (modal) {
    modal.style.display = 'none';
    currentUserConfirmCallback = null;
  }
}

function confirmUserAction() {
  console.log('🔔 confirmUserAction called');
  if (currentUserConfirmCallback && typeof currentUserConfirmCallback === 'function') {
    console.log('🔔 Executing confirmation callback...');
    try {
      currentUserConfirmCallback();
      console.log('🔔 Confirmation callback executed successfully');
    } catch (error) {
      console.error('🔔 Error executing confirmation callback:', error);
    }
  } else {
    console.error('🔔 No valid confirmation callback found');
  }
  closeUserConfirmModal();
}

// Add click-outside-to-close functionality for confirmation modal
document.getElementById('userConfirmModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeUserConfirmModal();
  }
});

function showAdminPasswordModal(action, callback) {
  console.log('🔐 showAdminPasswordModal called with action:', action);
  console.log('🔐 Callback function:', callback);
  console.log('🔐 Callback type:', typeof callback);
  console.log('🔐 Callback is function:', typeof callback === 'function');
  
  currentAdminAction = action;
  currentAdminCallback = callback;
  
  console.log('🔐 Stored currentAdminCallback:', currentAdminCallback);
  console.log('🔐 Stored currentAdminAction:', currentAdminAction);
  
  // Clear search input to prevent auto-fill conflict
  const searchInput = document.getElementById('userSearch');
  if (searchInput) {
    console.log('🔐 Clearing search input to prevent auto-fill conflict...');
    searchInput.value = '';
    searchInput.removeAttribute('data-user-typed');
  }
  
  const actionText = document.getElementById('adminPasswordAction');
  const modal = document.getElementById('adminPasswordModal');
  const passwordInput = document.getElementById('adminPasswordInput');
  
  console.log('🔐 Modal elements found:', { actionText, modal, passwordInput });
  
  // Set action text
  if (action === 'add') {
    actionText.textContent = 'Enter password to add a new user:';
  } else if (action === 'update') {
    actionText.textContent = 'Enter password to update this user:';
  } else if (action === 'deactivate') {
    actionText.textContent = 'Enter password to deactivate this user:';
  } else if (action === 'activate') {
    actionText.textContent = 'Enter password to activate this user:';
  } else if (action === 'reactivate') {
    actionText.textContent = 'Enter password to reactivate this user:';
  } else if (action === 'delete') {
    actionText.textContent = 'Enter password to delete this user:';
  }
  
  // Show modal
  console.log('🔐 Showing password modal...');
  modal.style.display = 'flex';
  passwordInput.value = '';
  passwordInput.focus();
}

function closeAdminPasswordModal() {
  const modal = document.getElementById('adminPasswordModal');
  modal.style.display = 'none';
  currentAdminAction = null;
  currentAdminCallback = null;
  
  // Hide password verification status indicators
  hidePasswordVerificationStatus();
  
  // Clear password input
  const passwordInput = document.getElementById('adminPasswordInput');
  if (passwordInput) passwordInput.value = '';
}

function handleAdminPasswordKeypress(event) {
  if (event.key === 'Enter') {
    submitAdminPassword();
  }
}

function toggleAdminPasswordVisibility() {
  const passwordInput = document.getElementById('adminPasswordInput');
  const toggleIcon = document.getElementById('toggleAdminPasswordIcon');
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    toggleIcon.textContent = '🙈';
  } else {
    passwordInput.type = 'password';
    toggleIcon.textContent = '👁️';
  }
}

async function submitAdminPassword() {
  const password = document.getElementById('adminPasswordInput').value.trim();
  
  if (!password) {
    showToast('Please enter your password', 'error');
    return;
  }

  try {
    // Show loading state
    const verifyBtn = document.querySelector('#adminPasswordModal button[onclick="submitAdminPassword()"]');
    const originalText = verifyBtn.textContent;
    verifyBtn.textContent = 'Verifying...';
    verifyBtn.disabled = true;

    // Show verification status indicators
    showPasswordVerificationStatus('verifying', 'Verifying password...');

    console.log('🔐 Starting password verification...');
    console.log('🔐 Password length:', password.length);
    console.log('🔐 JWT Token exists:', !!(localStorage.getItem('jwt_token') || localStorage.getItem('sessionToken') || localStorage.getItem('session_token')));
    console.log('🔐 API Config available:', !!(window.API_CONFIG && window.makeApiRequest));
    
    // Use the existing verifyAdminPassword function that's already connected to your API
    const isValid = await verifyAdminPassword(password);
    
    console.log('🔐 Password verification result:', isValid);

    if (isValid) {
      // Show success status
      showPasswordVerificationStatus('success', 'Password verified successfully!');
      
      // Wait a moment to show success status
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      showToast('Password verified successfully', 'success');
      
      // Execute the callback function BEFORE closing the modal
      console.log('🔐 About to execute callback...');
      console.log('🔐 currentAdminCallback exists:', !!currentAdminCallback);
      console.log('🔐 currentAdminCallback type:', typeof currentAdminCallback);
      console.log('🔐 currentAdminCallback value:', currentAdminCallback);
      
      if (currentAdminCallback && typeof currentAdminCallback === 'function') {
        console.log('🔐 Executing admin callback...');
        console.log('🔐 Callback function:', currentAdminCallback);
        try {
          currentAdminCallback();
          console.log('🔐 Callback executed successfully');
        } catch (error) {
          console.error('🔐 Error executing callback:', error);
          console.error('🔐 Error stack:', error.stack);
        }
      } else {
        console.error('🔐 No valid callback function found');
        console.log('🔐 currentAdminCallback:', currentAdminCallback);
        console.log('🔐 typeof currentAdminCallback:', typeof currentAdminCallback);
        console.log('🔐 currentAdminAction:', currentAdminAction);
      }
      
      // Close modal AFTER executing callback
      closeAdminPasswordModal();
    } else {
      // Show error status
      showPasswordVerificationStatus('error', 'Invalid password. Please try again.');
      
      showToast('Invalid password. Please try again.', 'error');
      document.getElementById('adminPasswordInput').value = '';
      document.getElementById('adminPasswordInput').focus();
    }
  } catch (error) {
    console.error('Password verification error:', error);
    
    // Show error status
    showPasswordVerificationStatus('error', 'Network error. Please try again.');
    
    showToast('Error verifying password. Please try again.', 'error');
    document.getElementById('adminPasswordInput').value = '';
    document.getElementById('adminPasswordInput').focus();
  } finally {
    // Restore button state
    const verifyBtn = document.querySelector('#adminPasswordModal button[onclick="submitAdminPassword()"]');
    verifyBtn.textContent = 'Verify';
    verifyBtn.disabled = false;
    
    // Hide status indicators after a delay
    setTimeout(() => {
      hidePasswordVerificationStatus();
    }, 3000);
  }
}

// Password verification status functions
function showPasswordVerificationStatus(status, message) {
  const indicator = document.getElementById('passwordStatusIndicator');
  const messageDiv = document.getElementById('passwordStatusMessage');
  const icon = document.getElementById('passwordStatusIcon');
  const text = document.getElementById('passwordStatusText');
  const passwordInput = document.getElementById('adminPasswordInput');
  
  if (!indicator || !messageDiv || !icon || !text) return;
  
  // Show the indicators
  indicator.style.display = 'block';
  messageDiv.style.display = 'block';
  
  // Update input field styling based on status
  if (passwordInput) {
    switch (status) {
      case 'verifying':
        passwordInput.style.borderColor = '#4a9eff';
        passwordInput.style.boxShadow = '0 0 0 2px rgba(74, 158, 255, 0.2)';
        break;
      case 'success':
        passwordInput.style.borderColor = '#10b981';
        passwordInput.style.boxShadow = '0 0 0 2px rgba(16, 185, 129, 0.2)';
        break;
      case 'error':
        passwordInput.style.borderColor = '#ef4444';
        passwordInput.style.boxShadow = '0 0 0 2px rgba(239, 68, 68, 0.2)';
        break;
    }
  }
  
  // Set status-specific styling and content
  switch (status) {
    case 'verifying':
      icon.textContent = '⏳';
      icon.style.color = '#4a9eff';
      text.textContent = message;
      text.style.color = '#4a9eff';
      break;
    case 'success':
      icon.textContent = '✅';
      icon.style.color = '#10b981';
      text.textContent = message;
      text.style.color = '#10b981';
      break;
    case 'error':
      icon.textContent = '❌';
      icon.style.color = '#ef4444';
      text.textContent = message;
      text.style.color = '#ef4444';
      break;
  }
}

function hidePasswordVerificationStatus() {
  const indicator = document.getElementById('passwordStatusIndicator');
  const messageDiv = document.getElementById('passwordStatusMessage');
  const passwordInput = document.getElementById('adminPasswordInput');
  
  if (indicator) indicator.style.display = 'none';
  if (messageDiv) messageDiv.style.display = 'none';
  
  // Reset input field styling
  if (passwordInput) {
    passwordInput.style.borderColor = '#2a3b6d';
    passwordInput.style.boxShadow = 'none';
  }
}

// Toast Notification Functions
function showToast(message, type = 'info') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  
  const colors = {
    success: '#10b981',
    error: '#ef4444',
    warning: '#f59e0b',
    info: '#3b82f6'
  };
  
  const icons = {
    success: '✅',
    error: '❌',
    warning: '⚠️',
    info: 'ℹ️'
  };
  
  toast.style.cssText = `
    background: ${colors[type] || colors.info};
    color: white;
    padding: 12px 16px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 500;
    max-width: 350px;
    animation: slideInRight 0.3s ease-out;
    position: relative;
    overflow: hidden;
  `;
  
  toast.innerHTML = `
    <span style="font-size: 16px;">${icons[type] || icons.info}</span>
    <span style="flex: 1;">${message}</span>
    <button onclick="this.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer; padding: 4px; border-radius: 4px; font-size: 18px; line-height: 1;">&times;</button>
  `;
  
  // Add CSS animation if not already added
  if (!document.getElementById('toastAnimations')) {
    const style = document.createElement('style');
    style.id = 'toastAnimations';
    style.textContent = `
      @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  }
  
  container.appendChild(toast);
  
  // Auto remove after 5 seconds
  setTimeout(() => {
    if (toast.parentElement) {
      toast.style.animation = 'slideOutRight 0.3s ease-in';
      setTimeout(() => {
        if (toast.parentElement) {
          toast.remove();
        }
      }, 300);
    }
  }, 5000);
}

// Close modal when clicking outside
document.getElementById('adminPasswordModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeAdminPasswordModal();
  }
});

// Test function to debug API connection
async function testApiConnection() {
  console.log('🧪 Testing API connection...');
  
  // Check if API config is loaded
  console.log('🧪 API Config loaded:', !!window.API_CONFIG);
  console.log('🧪 makeApiRequest available:', !!window.makeApiRequest);
  console.log('🧪 JWT Token available:', !!(localStorage.getItem('jwt_token') || localStorage.getItem('sessionToken') || localStorage.getItem('session_token')));
  
  if (window.API_CONFIG) {
    console.log('🧪 API Base URL:', window.API_CONFIG.BASE_URL);
    console.log('🧪 Verify Password Endpoint:', window.API_CONFIG.ENDPOINTS.ADMIN.VERIFY_PASSWORD);
  }
  
  // Test a simple API call
  try {
    const jwtToken = localStorage.getItem('jwt_token') || localStorage.getItem('sessionToken') || localStorage.getItem('session_token');
    if (jwtToken) {
      console.log('🧪 Testing with JWT token...');
      const response = await fetch('/api/admin/test', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${jwtToken}`,
          'Content-Type': 'application/json'
        }
      });
      console.log('🧪 Test API response status:', response.status);
      const result = await response.json();
      console.log('🧪 Test API response:', result);
    } else {
      console.log('🧪 No JWT token found for testing');
    }
  } catch (error) {
    console.error('🧪 API test failed:', error);
  }
}

// Run API test when page loads
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(testApiConnection, 1000);
});
</script>

<script src="assets/js/config/error-handler.js"></script>

<style>
/* Prevent autofill styling on search input - keep dark background */
.user-search-input:-webkit-autofill,
.user-search-input:-webkit-autofill:hover,
.user-search-input:-webkit-autofill:focus,
.user-search-input:-webkit-autofill:active {
  -webkit-box-shadow: 0 0 0 30px #181f36 inset !important;
  -webkit-text-fill-color: #e0e6f6 !important;
  background-color: #181f36 !important;
  color: #e0e6f6 !important;
  background: #181f36 !important;
  border: 1px solid #2a3b6d !important;
}

/* Additional protection for all autofill states */
.user-search-input[data-autofilled] {
  background-color: #181f36 !important;
  background: #181f36 !important;
  color: #e0e6f6 !important;
  border: 1px solid #2a3b6d !important;
}

/* Force dark styling on any autofill */
input.user-search-input {
  background-color: #181f36 !important;
  background: #181f36 !important;
  color: #e0e6f6 !important;
  border: 1px solid #2a3b6d !important;
}

/* Prevent all input fields from turning white when filled or focused */
input[type="text"],
input[type="email"],
input[type="password"],
input[type="date"],
input[type="week"],
input[type="month"],
input[type="number"],
input.user-search-input,
input.user-filter-date,
input.report-select {
  background-color: #181f36 !important;
  background: #181f36 !important;
  color: #e0e6f6 !important;
  border: 1px solid #2a3b6d !important;
}

/* Prevent autofill styling on all inputs */
input[type="text"]:-webkit-autofill,
input[type="text"]:-webkit-autofill:hover,
input[type="text"]:-webkit-autofill:focus,
input[type="text"]:-webkit-autofill:active,
input[type="email"]:-webkit-autofill,
input[type="email"]:-webkit-autofill:hover,
input[type="email"]:-webkit-autofill:focus,
input[type="email"]:-webkit-autofill:active,
input[type="password"]:-webkit-autofill,
input[type="password"]:-webkit-autofill:hover,
input[type="password"]:-webkit-autofill:focus,
input[type="password"]:-webkit-autofill:active {
  -webkit-box-shadow: 0 0 0 30px #181f36 inset !important;
  -webkit-text-fill-color: #e0e6f6 !important;
  background-color: #181f36 !important;
  color: #e0e6f6 !important;
  background: #181f36 !important;
  border: 1px solid #2a3b6d !important;
}

/* Force dark styling on focus */
input[type="text"]:focus,
input[type="email"]:focus,
input[type="password"]:focus,
input[type="date"]:focus,
input[type="week"]:focus,
input[type="month"]:focus,
input[type="number"]:focus {
  background-color: #181f36 !important;
  background: #181f36 !important;
  color: #e0e6f6 !important;
  border: 1px solid #4a9eff !important;
  outline: none !important;
}

/* Action button styling for different user statuses */
.action-btn.reactivate {
  background: #10b981 !important;
  color: white !important;
  border: 1px solid #10b981 !important;
}

.action-btn.reactivate:hover {
  background: #059669 !important;
  border-color: #059669 !important;
}

.action-btn.deactivate {
  background: #f59e0b !important;
  color: white !important;
  border: 1px solid #f59e0b !important;
}

.action-btn.deactivate:hover {
  background: #d97706 !important;
  border-color: #d97706 !important;
}
</style>

</body>
</html>


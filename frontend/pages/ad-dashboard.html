<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="../assets/css/Admin-assets/sidebar.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/dashboard.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/analyticstat.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/ad-chart.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/spoilageReport.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/report-generator.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/user.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/feedbacks.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/account-modal.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/admin-log.css">
  <link rel="stylesheet" href="../assets/css/Admin-assets/device-management.css?v=1.2">
  <link rel="stylesheet" href="../assets/css/Admin-assets/ml-predictions.css?v=1.0">
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.js"></script>
  <script>
    // Fallback if unpkg fails
    if (typeof window.jspdf === 'undefined') {
      document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"><\/script>');
      document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"><\/script>');
    }
  </script>
</head>
<body>
<aside class="sidebar expanded" id="sidebar">
  <div class="sidebar-header">
    <span class="sidebar-logo" id="sidebarLogo" style="cursor:pointer;">&#128230;</span>
    <span class="sidebar-title">Admin</span>
  </div>
  <nav class="sidebar-nav">
    <!-- Core System Section -->
    <div class="nav-section">
      <div class="nav-section-header">Core System</div>
      <ul>
        <li class="nav-item active">
          <a href="#" class="nav-link" data-page="dashboard" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#8962;</span>
            <span class="nav-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="analytics-summary" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128200;</span>
            <span class="nav-text">Sensor Analytics</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="ml-predictions" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#129302;</span>
            <span class="nav-text">ML Predictions</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="device-management" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128187;</span>
            <span class="nav-text">Device Management</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Reports Section -->
    <div class="nav-section">
      <div class="nav-section-header">Reports</div>
      <ul>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="report-generator" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128229;</span>
            <span class="nav-text">Report Generator</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- User Management Section -->
    <div class="nav-section">
      <div class="nav-section-header">User Management</div>
      <ul>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="users" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128101;</span>
            <span class="nav-text">Users</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="user-activity-log" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128221;</span>
            <span class="nav-text">User Activity Log</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="admin-log" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128273;</span>
            <span class="nav-text">Admin Logs</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Support Section -->
    <div class="nav-section">
      <div class="nav-section-header">Support</div>
      <ul>
        <li class="nav-item">
          <a href="#" class="nav-link" data-page="feedbacks" style="display:flex;align-items:center;gap:16px;color:inherit;text-decoration:none;width:100%">
            <span class="nav-icon">&#128172;</span>
            <span class="nav-text">Feedback & Support</span>
          </a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="sidebar-account" id="sidebarAccountBtn" onclick="openAdminAccountModal()" style="cursor: pointer;">
    <span class="account-icon">&#128100;</span>
    <span class="account-text">Account</span>
    <button class="logout-btn" id="logoutBtn" type="button" style="background:none;border:none;color:#666;cursor:pointer;margin-left:auto;font-size:12px;" onclick="event.stopPropagation();">Logout</button>
  </div>
</aside>
<main id="main-content">
  <!-- Content will be loaded here by spa.js -->
</main>

<template id="dashboard-template">
    <div class="dashboard-container">
        <div class="dashboard-row">
          <div class="dashboard-card sensors-card">
            <div class="sensors-header">
              <h4>Dashboard</h4>
            </div>
            <div class="stat-cards-container">
              <div class="stat-card">
                <div class="stat-card-header">
                  <div class="stat-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value">142</div>
                    <div class="stat-label">Active Users</div>
                  </div>
                </div>
                <div class="stat-chart">
                  <canvas id="userChart"></canvas>
                </div>
              </div>
              <div class="stat-card highlight">
                <div class="stat-card-header">
                  <div class="stat-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M21.75 8a.75.75 0 00-.75-.75h-2.25a.75.75 0 000 1.5h2.25a.75.75 0 00.75-.75z"/><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM3.75 12a8.25 8.25 0 1116.5 0 8.25 8.25 0 01-16.5 0z"/></svg>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value">89</div>
                    <div class="stat-label">Device Reports</div>
                  </div>
                </div>
                <div class="stat-chart">
                  <canvas id="deviceChart"></canvas>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-card-header">
                  <div class="stat-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value">31</div>
                  <div class="stat-label">Active Devices</div>
                  </div>
                </div>
                <div class="stat-chart">
                  <canvas id="alertChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="dashboard-row">
          <div class="dashboard-card tall activity-card" style="flex:2;">
            <div class="activity-header">
              <span class="activity-title">Device Used Count</span>
              <select class="activity-filter">
                <option selected>Monthly</option>
                <option>Yearly</option>
              </select>
            </div>
            <div class="activity-counters" style="display:flex;flex-direction:column;gap:6px;background:#162449;border:1px solid #243760;border-radius:8px;padding:10px 12px;margin:6px 0 10px 0;color:#bfc9da;">
              <div id="count-today">Today: 0</div>
              <div id="count-7d">Last 7d: 0</div>
              <div id="count-30d">Last 30d: 0</div>
            </div>
            <canvas id="activityChart"></canvas>
          </div>
          <div class="dashboard-card tall recent-reviews-card" style="flex:1;display:flex;flex-direction:column;">
            <h4 style="margin:0 0 20px 0;color:#fff;font-size:1.4em;font-weight:600;">Recent Reviews</h4>
            <div id="recent-reviews-container" class="recent-reviews-container">
              <div class="loading-reviews">Loading reviews...</div>
            </div>
          </div>
        </div>
      </div>
</template>

<!-- ML Predictions & Analytics -->
<template id="ml-predictions-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>ML Predictions & Analytics</h1>
        <div class="spoilage-subtitle">Explore AI-driven spoilage predictions and model performance</div>
      </div>
      
    </div>

    <div class="ml-kpi-row">
      <div class="ml-kpi-card"><div class="ml-kpi-title">Total Predictions</div><div class="ml-kpi-value" id="mlKpiTotal">0</div><div class="ml-kpi-sub" id="mlKpiTotalSub">+0 today</div></div>
      <div class="ml-kpi-card"><div class="ml-kpi-title">Average Confidence</div><div class="ml-kpi-value" id="mlKpiConfidence">--%</div><div class="ml-kpi-sub" id="mlKpiConfidenceSub">+0% this week</div></div>
      <div class="ml-kpi-card"><div class="ml-kpi-title">Training Data</div><div class="ml-kpi-value" id="mlKpiSamples">0</div><div class="ml-kpi-sub" id="mlKpiSamplesSub">+0 added</div></div>
      <div class="ml-kpi-card"><div class="ml-kpi-title">Model Accuracy</div><div class="ml-kpi-value" id="mlKpiAccuracy">--%</div><div class="ml-kpi-sub" id="mlKpiAccuracySub">+0% improved</div></div>
    </div>

    

    <div class="ml-card" style="margin-top:16px;">
      <div class="ml-card-header">
        <div class="ml-card-title">Training Data (<span id="mlSamplesCount">0</span>)</div>
        <div class="ml-actions">
          <button class="ml-btn primary" id="mlAddTraining">+ Add Training Data</button>
        </div>
      </div>
      <table class="ml-table">
        <thead>
          <tr>
            <th>Food Category</th>
            <th>Environmental Conditions</th>
            <th>Actual Status</th>
            <th>Data Quality</th>
            <th>Source</th>
            <th>Date Added</th>
          </tr>
        </thead>
        <tbody id="mlSamplesTableBody"></tbody>
      </table>
        <div id="mlSamplesPagination" class="pagination-container" style="display:none;margin-top:10px;">
          <div id="mlSamplesPageInfo" class="pagination-info"></div>
          <div id="mlSamplesPageControls" class="pagination-controls"></div>
        </div>
    </div>
  </div>
</template>

<!-- ML Predictions & Analytics - Detail -->
<template id="ml-predictions-detail-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>ML Predictions & Analytics</h1>
        <div class="spoilage-subtitle">Detailed prediction records with filters and export</div>
      </div>
      
    </div>
    <div class="report-generator-card">
      <div class="report-controls">
        <div class="report-control-group">
          <label for="mlSearch">Search</label>
          <input id="mlSearch" class="report-date-input" placeholder="Device, user, or model" />
        </div>
        <div class="report-control-group">
          <label for="mlDateRange">Date Range</label>
          <select id="mlDateRange" class="report-select">
            <option value="all">All Time</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
        <div class="report-control-group" id="mlWeekGroup" style="display:none;min-width:200px;">
          <label for="mlWeekPicker">Select Week</label>
          <input type="week" id="mlWeekPicker" />
        </div>
        <div class="report-control-group" id="mlMonthGroup" style="display:none;min-width:200px;">
          <label for="mlMonthPicker">Select Month</label>
          <input type="month" id="mlMonthPicker" />
        </div>
        <div class="report-control-group" id="mlYearGroup" style="display:none;min-width:160px;">
          <label for="mlYearPicker">Select Year</label>
          <input type="number" id="mlYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
        </div>
        <div class="report-control-group">
          <label for="mlRecordsPerPage">Records per Page</label>
          <select id="mlRecordsPerPage" class="report-select">
            <option value="10">10</option>
            <option value="25" selected>25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
      </div>
      <div class="report-actions">
        <button id="mlApplyFilters" class="report-btn report-btn-primary"><span>üîé</span>Filter</button>
        <button id="mlExportCSV" class="report-btn report-btn-secondary"><span>üì•</span>Download CSV</button>
        <button id="mlExportPDF" class="filter-btn export"><span>üìÑ</span>Download PDF</button>
      </div>
    </div>
    <div class="report-preview">
      <h2 class="report-preview-title">ML Predictions</h2>
      <div class="report-table-container">
        <table class="admin-log-table">
          <thead>
            <tr>
              <th>DATE/TIME</th>
              <th>DEVICE</th>
              <th>USER</th>
              <th>SENSOR</th>
              <th>MODEL</th>
              <th>PREDICTION</th>
              <th>CONFIDENCE</th>
            </tr>
          </thead>
          <tbody id="mlPredictionsTableBody"></tbody>
        </table>
      </div>
      <div id="mlPagination" class="pagination-container" style="display:none;">
        <div id="mlPageInfo" class="pagination-info"></div>
        <div id="mlPageControls" class="pagination-controls"></div>
      </div>
    </div>
  </div>
</template>
<!-- Sensor Analytics Summary -->
<template id="analytics-summary-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>Sensor Analytics</h1>
        <div class="spoilage-subtitle">Monitor portable food spoilage sensors used by food testers</div>
      </div>
      <div class="spoilage-header-buttons">
        <a href="#" class="spoilage-btn active" data-page="analytics-summary">Summary</a>
        <a href="#" class="spoilage-btn" data-page="analytics-detail">Detailed View</a>
      </div>
    </div>
    <div class="spoilage-stats-row">
      <div class="spoilage-stat-card"><div class="stat-icon stat-blue">&#128230;</div><div class="stat-label">Total Sensors</div><div class="stat-value">156</div></div>
      <div class="spoilage-stat-card"><div class="stat-icon stat-green">&#10003;</div><div class="stat-label">Active Testers</div><div class="stat-value">142</div></div>
      <div class="spoilage-stat-card"><div class="stat-icon stat-red">&#10060;</div><div class="stat-label">Spoilage Alert</div><div class="stat-value">6</div></div>
      <div class="spoilage-stat-card"><div class="stat-icon stat-gray">&#9200;</div><div class="stat-label">Inactive</div><div class="stat-value">12</div></div>
    </div>
    <div class="spoilage-main-cards">
      <div class="spoilage-card spoilage-bar-card">
        <div class="spoilage-card-title">Sensor Usage by Tester Type</div>
        <div class="spoilage-bar-list">
          <div class="spoilage-bar-row"><span class="bar-label">Street Food Testers</span><div class="bar-bg"><div class="bar-fill bar-red" style="width:65%"></div></div><span class="bar-value">65%</span></div>
          <div class="spoilage-bar-row"><span class="bar-label">Food Truck Inspectors</span><div class="bar-bg"><div class="bar-fill bar-red" style="width:25%"></div></div><span class="bar-value">25%</span></div>
          <div class="spoilage-bar-row"><span class="bar-label">Canteen Auditors</span><div class="bar-bg"><div class="bar-fill" style="width:10%"></div></div><span class="bar-value">10%</span></div>
        </div>
      </div>
      <div class="spoilage-card spoilage-summary-card">
        <div class="spoilage-card-title">Sensor Activity Summary</div>
        <div class="spoilage-summary-list">
          <div class="summary-row"><span class="summary-label">MQ4 Sensors</span><span class="summary-desc">98 food testers actively using</span><span class="summary-rate bar-red">81.7%</span></div>
          <div class="summary-row"><span class="summary-label">DHT11 Sensors</span><span class="summary-desc">32 food testers actively using</span><span class="summary-rate">88.9%</span></div>
          <div class="summary-row"><span class="summary-label">DS18B20 Sensors</span><span class="summary-desc">12 food testers actively using</span><span class="summary-rate">100%</span></div>
        </div>
        <div class="summary-total">Total Overview: <span class="summary-total-right">142 food testers actively using sensors</span></div>
      </div>
    </div>
  </div>
</template>

<!--Detailed-report-->
<template id="analytics-detail-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>Sensor Analytics</h1>
        <div class="spoilage-subtitle">Monitor portable food spoilage sensors used by food testers</div>
      </div>
      <div class="spoilage-header-buttons">
        <a href="#" class="spoilage-btn" data-page="analytics-summary">Summary</a>
        <a href="#" class="spoilage-btn active" data-page="analytics-detail">Detailed View</a>
      </div>
    </div>
    <div class="detailed-report-card">
      <div class="detailed-report-filters">
        <div class="filter-row">
          <div class="filter-group" style="min-width:240px;">
            <label>Name Search</label>
            <input type="text" id="nameSearch" placeholder="Search food tester name..." />
          </div>
          <div class="filter-group">
            <label>Tester Type</label>
            <select id="testerType">
              <option value="all">All Types</option>
              <!-- Will be populated dynamically from database -->
            </select>
          </div>
          <div class="filter-group">
            <label>Status</label>
            <select id="status">
              <option value="all">All Status</option>
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
              <option value="No Device">No Device</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Date Range</label>
            <select id="dateRange">
              <option value="all">All Time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group" id="analyticsWeekGroup" style="display:none;min-width:200px;">
            <label for="analyticsWeekPicker">Select Week</label>
            <input type="week" id="analyticsWeekPicker" />
          </div>
          <div class="filter-group" id="analyticsMonthGroup" style="display:none;min-width:200px;">
            <label for="analyticsMonthPicker">Select Month</label>
            <input type="month" id="analyticsMonthPicker" />
          </div>
          <div class="filter-group" id="analyticsYearGroup" style="display:none;min-width:160px;">
            <label for="analyticsYearPicker">Select Year</label>
            <input type="number" id="analyticsYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          <div class="filter-group">
            <label>Records per Page</label>
            <select id="recordsPerPage">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="filter-row"></div>
        <div class="filter-row custom-date-row" id="analyticsCustomDateGroup" style="display: none;">
          <div class="filter-group">
            <label>Start Date</label>
            <input type="date" id="startDate" />
          </div>
          <div class="filter-group">
            <label>End Date</label>
            <input type="date" id="endDate" />
          </div>
        </div>
        <div class="filter-actions">
          <button class="filter-btn" type="button" id="applyFilters" title="Apply filters" aria-label="Apply filters">üîé Filter</button>
          <button class="filter-btn export" id="exportCSV">Export CSV</button>
          <button class="filter-btn export" id="exportPDF">Download PDF</button>
        </div>
      </div>
      <div class="detailed-report-table-card">
        <div class="detailed-report-title">Detailed Sensor Report (<span id="sensorCount">156</span> devices)</div>
        <div class="report-table-container">
        <table class="detailed-report-table admin-log-table">
          <thead>
            <tr>
              <th>FOOD TESTER</th>
              <th>TYPE</th>
              <th>STATUS</th>
              <th>LAST PING</th>
              <th>LAST READING</th>
              <th>ALERTS</th>
            </tr>
          </thead>
          <tbody id="sensorTableBody">
            <tr>
              <td>Juan's Tacos Cart<br><span class="created-date">Registered: 6/25/2025</span></td>
              <td><span class="cat-badge">Street Food Tester</span></td>
              <td><span class="status-badge spoiled">Spoilage Alert</span></td>
              <td>6/26/2025<br><span class="expiry-today">2 mins ago</span></td>
              <td>Gas: 380 ppm</td>
              <td><span class="alert-badge">3 alerts</span></td>
            </tr>
            <tr>
              <td>Maria's Food Truck<br><span class="created-date">Registered: 6/22/2025</span></td>
              <td><span class="cat-badge">Food Truck Inspector</span></td>
              <td><span class="status-badge expired">Inactive</span></td>
              <td>6/25/2025<br><span class="expiry-expired">1 day ago</span></td>
              <td>Temp: 4.2¬∞C, Hum: 78%</td>
              <td><span class="alert-badge none">0 alerts</span></td>
            </tr>
            <tr>
              <td>School Canteen #3<br><span class="created-date">Registered: 6/25/2025</span></td>
              <td><span class="cat-badge">Canteen Auditor</span></td>
              <td><span class="status-badge active">Active</span></td>
              <td>6/26/2025<br><span class="expiry-today">5 mins ago</span></td>
              <td>Temp: -1.8¬∞C</td>
              <td><span class="alert-badge">1 alert</span></td>
            </tr>
            <tr>
              <td>Carlos BBQ Cart<br><span class="created-date">Registered: 6/25/2025</span></td>
              <td><span class="cat-badge">Street Food Tester</span></td>
              <td><span class="status-badge active">Active</span></td>
              <td>6/30/2025<br><span class="expiry-days">1 min ago</span></td>
              <td>Gas: 220 ppm</td>
              <td><span class="alert-badge">2 alerts</span></td>
            </tr>
            <tr>
              <td>Office Canteen A<br><span class="created-date">Registered: 6/24/2025</span></td>
              <td><span class="cat-badge">Canteen Auditor</span></td>
              <td><span class="status-badge spoiled">Spoilage Alert</span></td>
              <td>6/26/2025<br><span class="expiry-today">3 mins ago</span></td>
              <td>Temp: 25.3¬∞C, Hum: 89%</td>
              <td><span class="alert-badge">4 alerts</span></td>
            </tr>
            <tr>
              <td>Beach Food Truck #2<br><span class="created-date">Registered: 6/23/2025</span></td>
              <td><span class="cat-badge">Food Truck Inspector</span></td>
              <td><span class="status-badge active">Active</span></td>
              <td>6/26/2025<br><span class="expiry-today">1 min ago</span></td>
              <td>Temp: 3.8¬∞C</td>
              <td><span class="alert-badge none">0 alerts</span></td>
            </tr>
          </tbody>
        </table>
        </div>
        <style>
          /* Detailed table card - match report generator card styling */
          .detailed-report-table-card {
            background-color: #212c4d;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          }
          .detailed-report-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #e0e0e0;
            margin-bottom: 20px;
          }
          #analyticsPagination {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: #22336a;
            border-radius: 12px;
            border: 1px solid #344e6e;
            visibility: visible !important;
            opacity: 1 !important;
          }
          #analyticsPagination .pagination-info {
            text-align: left;
            align-self: flex-start;
            width: 100%;
            color: #bfc9da;
            font-size: 0.9em;
          }
          #analyticsPagination .pagination-controls {
            display: flex;
            justify-content: center;
            align-self: center;
            width: 100%;
          }
        </style>
        <div id="analyticsPagination" class="pagination">
          <div id="analyticsPageInfo" class="pagination-info"></div>
          <div class="pagination-controls" id="analyticsPageControls"></div>
        </div>
      </div>
    </div>
  </div>
</template>

<!-- Report Generator -->
<template id="report-generator-template">
  <div class="report-generator-main">
    <div class="report-generator-container">
      <div class="report-generator-header">
        <h1 class="report-generator-title">Report Generator</h1>
        <p class="report-generator-subtitle">Select a report type and date range to generate and download data.</p>
      </div>
      
      <div class="report-generator-card">
        <div class="report-controls">
          <div class="report-control-group">
            <label for="reportType">Report Type</label>
            <select id="reportType" class="report-select">
              <option value="new_users">New User Count</option>
              <option value="top_spoiling_food">Top Spoiling Foods</option>
            </select>
          </div>
          
          <div class="report-control-group">
            <label for="reportDateRange">Date Range</label>
            <select id="reportDateRange" class="report-select">
              <option value="All Time">All Time</option>
              <option value="Daily">Daily</option>
              <option value="Weekly">Weekly</option>
              <option value="Monthly">Monthly</option>
              <option value="Yearly">Yearly</option>
              <option value="Custom">Custom</option>
            </select>
          </div>
          
          <div class="report-control-group" id="reportWeekGroup" style="display:none;min-width:200px;">
            <label for="reportWeekPicker">Select Week</label>
            <input type="week" id="reportWeekPicker" />
          </div>
          
          <div class="report-control-group" id="reportMonthGroup" style="display:none;min-width:200px;">
            <label for="reportMonthPicker">Select Month</label>
            <input type="month" id="reportMonthPicker" />
          </div>
          
          <div class="report-control-group" id="reportYearGroup" style="display:none;min-width:160px;">
            <label for="reportYearPicker">Select Year</label>
            <input type="number" id="reportYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          
          <div class="report-control-group">
            <label for="reportRecordsPerPage">Records per Page</label>
            <select id="reportRecordsPerPage" class="report-select" onchange="changeReportRecordsPerPage(this.value)">
              <option value="10" selected>10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
          
          <div id="reportCustomDateGroup" style="display:none;">
            <div class="report-control-group">
              <label for="reportStartDate">Start Date</label>
              <input type="date" id="reportStartDate" class="report-date-input" />
            </div>
            <div class="report-control-group">
              <label for="reportEndDate">End Date</label>
              <input type="date" id="reportEndDate" class="report-date-input" />
            </div>
          </div>
          
          <div class="report-actions">
            <button id="generateReport" class="report-btn report-btn-primary">
              <span>üìä</span>
              Generate Report
            </button>
            <button id="exportReportCSV" class="report-btn report-btn-secondary">
              <span>üì•</span>
              Download CSV
            </button>
            <button id="exportReportPDF" class="report-btn report-btn-secondary">
              <span>üìÑ</span>
              Download PDF
            </button>
          </div>
        </div>
        
        <div class="report-preview">
          <h2 id="reportTitle" class="report-preview-title">Report Generator</h2>
          <div class="report-table-container">
            <div id="report-preview-content">
              <div class="empty-state">
                <div class="empty-state-content">
                  <div class="empty-state-icon">üìä</div>
                  <div class="empty-state-title">No Report Generated</div>
                  <div class="empty-state-desc">Select your report type and date range, then click "Generate Report" to view data.</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Pagination Container -->
          <div id="reportPagination" class="pagination-container" style="display:none;">
            <!-- Pagination will be rendered here by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>
</template>


<!-- User  -->
<template id="users-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>Users</h1>
        <div class="spoilage-subtitle">Manage clients who use your devices: create, edit, or delete accounts</div>
      </div>
    </div>
    <div class="report-generator-card">
      <div class="report-filters user-filters">
        <div class="filter-controls">
          <div class="filter-group">
            <label for="userSearch">Search</label>
            <input type="text" id="userSearch" class="user-search-input" placeholder="Search by name or email..." />
          </div>
          
          <div class="filter-group">
            <label for="userStatusFilter">Status</label>
            <select id="userStatusFilter" class="user-filter-select">
              <option value="">All Status</option>
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="userDateRangeFilter">Date Range</label>
            <select id="userDateRangeFilter" class="user-filter-select">
              <option value="alltime">All Time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group" id="userWeekPickerGroup" style="display:none;min-width:180px;">
            <label for="userWeekPicker" style="display:block;margin-bottom:6px;">Select Week</label>
            <input type="week" id="userWeekPicker" />
          </div>
          <div class="filter-group" id="userMonthPickerGroup" style="display:none;min-width:180px;">
            <label for="userMonthPicker" style="display:block;margin-bottom:6px;">Select Month</label>
            <input type="month" id="userMonthPicker" />
          </div>
          <div class="filter-group" id="userYearPickerGroup" style="display:none;min-width:140px;">
            <label for="userYearPicker" style="display:block;margin-bottom:6px;">Select Year</label>
            <input type="number" id="userYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          <div id="userCustomDateGroup" style="display:none;">
          <div class="filter-group">
            <label for="userDateStart">Start Date</label>
            <input type="date" id="userDateStart" class="user-filter-date" />
          </div>
          <div class="filter-group">
            <label for="userDateEnd">End Date</label>
            <input type="date" id="userDateEnd" class="user-filter-date" />
            </div>
          </div>
          <div class="filter-group">
            <label for="userRecordsPerPage">Records per Page</label>
            <select id="userRecordsPerPage" onchange="changeUserRecordsPerPage(this.value)">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="filter-actions">
          <button class="filter-btn" id="userFilterBtn">Filter</button>
          <button class="filter-btn" id="addUserBtn">+ Add User</button>
        </div>
      </div>
      <div class="report-preview-area">
        <div class="report-preview-title">Users</div>
        <table class="user-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              
              <th>Date Created</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="userTableBody">
            <!-- User rows will be rendered here by JS -->
          </tbody>
        </table>
        <div id="userPagination" class="pagination-container" style="display:none;">
          <!-- JS will render pagination here -->
        </div>
      </div>
    </div>
      <!-- User Modal -->
      <div class="user-modal" id="userModal" style="display:none;">
        <div class="user-modal-content" style="max-width: 500px; width: 90%;">
          <h2 id="userModalTitle">Add User</h2>
          <form id="userForm">
            <input type="hidden" id="userId" />
            
            <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
              <div class="form-group" style="flex: 1;">
                <label for="userFirstName">First Name *</label>
                <input type="text" id="userFirstName" required placeholder="Enter first name" />
              </div>
              <div class="form-group" style="flex: 1;">
                <label for="userLastName">Last Name *</label>
                <input type="text" id="userLastName" required placeholder="Enter last name" />
              </div>
            </div>
            <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
              <div class="form-group" style="flex: 1;">
                <label for="userEmail">Email *</label>
                <input type="email" id="userEmail" required placeholder="Enter email" />
              </div>
            </div>

            <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
              <div class="form-group" style="flex: 1;">
                <label for="userCategory">Category *</label>
                <select id="userCategory" required>
                  <option value="">Select Category</option>
                  <option value="1">Personal Tester</option>
                  <option value="2">Canteen Tester</option>
                  <option value="3">Restaurant Tester</option>
                  <option value="4">Cafeteria Tester</option>
                  <option value="5">Catering Tester</option>
                </select>
              </div>
              <div class="form-group" style="flex: 1;">
                <label for="userStatus">Status *</label>
                <select id="userStatus" required>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
            </div>

            <div class="form-group" style="margin-bottom: 15px;">
              <label>Date Created</label>
              <input type="text" id="userDateCreated" readonly style="background:#181f36;color:#bfc9da;width:100%;" />
            </div>

            <div class="form-group password-group" style="display:none; margin-bottom: 15px;">
              <label for="userPassword">New Password</label>
              <div style="position:relative;display:flex;align-items:center;">
                <input type="password" id="userPassword" autocomplete="new-password" minlength="6" placeholder="Enter new password... (leave blank to keep current)" style="flex:1;width:100%;" />
                <button type="button" id="toggleUserPassword" style="position:absolute;right:10px;background:none;border:none;cursor:pointer;padding:0 6px;color:#bfc9da;" tabindex="-1" aria-label="Show password">
                    <span id="toggleUserPasswordIcon">&#128065;</span>
                </button>
              </div>
            </div>

            <div class="modal-actions" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
              <button type="submit" class="filter-btn" style="background: #4a5b8d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">Save</button>
              <button type="button" class="filter-btn export" id="cancelUserBtn" style="background: #2a3b6d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">Cancel</button>
            </div>
          </form>
        </div>
      </div>
  </div>
</template>

    <!-- user ctivvity log -->
<template id="user-activity-log-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>User Activity Log</h1>
        <div class="spoilage-subtitle">View all actions performed by users/clients in the system</div>
      </div>
    </div>
    <div class="report-generator-card">
      <div class="report-controls">
        <div class="report-control-group">
          <label for="activityTypeFilter" style="display:block;margin-bottom:6px;">Activity Type</label>
          <select id="activityTypeFilter" class="report-select">
            <option value="all">All User Activities</option>
            <option value="logged in">User Login</option>
            <option value="logged out">User Logout</option>
            <option value="registered">User Registration</option>
            <option value="profile updated">Profile Update</option>
            <option value="changed password">Password Change</option>
            <option value="analysis performed">AI Analysis</option>
            <option value="chat conversation">AI Chat</option>
          </select>
        </div>
        <div class="report-control-group">
          <label for="activityDateRange" style="display:block;margin-bottom:6px;">Date Range</label>
          <select id="activityDateRange" class="report-select">
            <option value="all">All Time</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        
        <div class="report-control-group" id="activityWeekGroup" style="display:none;min-width:200px;">
          <label for="activityWeekPicker" style="display:block;margin-bottom:6px;">Select Week</label>
          <input type="week" id="activityWeekPicker" class="report-select" />
        </div>
        
        <div class="report-control-group" id="activityMonthGroup" style="display:none;min-width:200px;">
          <label for="activityMonthPicker" style="display:block;margin-bottom:6px;">Select Month</label>
          <input type="month" id="activityMonthPicker" class="report-select" />
        </div>
        
        <div class="report-control-group" id="activityYearGroup" style="display:none;min-width:160px;">
          <label for="activityYearPicker" style="display:block;margin-bottom:6px;">Select Year</label>
          <input type="number" id="activityYearPicker" class="report-select" min="1970" max="2100" step="1" placeholder="2025" />
        </div>
        
        <div class="report-control-group">
          <label for="activityRecordsPerPage" style="display:block;margin-bottom:6px;">Records per Page</label>
          <select id="activityRecordsPerPage" class="report-select" onchange="changeActivityLogRecordsPerPage(this.value)">
            <option value="10" selected>10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
        
        <div id="activityCustomDateGroup" style="display:none;">
          <div class="report-control-group">
              <label for="activityDateStart" style="display:block;margin-bottom:6px;">Start Date</label>
              <input type="date" id="activityDateStart" class="report-select" />
          </div>
          <div class="report-control-group">
              <label for="activityDateEnd" style="display:block;margin-bottom:6px;">End Date</label>
              <input type="date" id="activityDateEnd" class="report-select" />
          </div>
        </div>
        
        <div class="report-actions">
          <button id="filterActivityLogBtn" class="report-btn report-btn-primary">
            <span>üîç</span>
            Filter
          </button>
          <button id="exportActivityLogExcel" class="filter-btn export">
            <span>üì•</span>
            Download Excel
          </button>
          <button id="exportActivityLogPDF" class="filter-btn export">
            <span>üìÑ</span>
            Download PDF
          </button>
        </div>
      </div>
      <div class="report-preview">
        <h2 class="report-preview-title">Activity Log</h2>
        <div class="report-table-container">
          <table class="admin-log-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Activity</th>
                <th>Date/Time</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody id="activityLogTableBody">
              <!-- Activity rows will be rendered here by JS -->
            </tbody>
          </table>
        </div>
        <div id="activityLogPagination" class="pagination-container" style="display:none;">
          <!-- JS will render pagination here -->
        </div>
      </div>
    </div>
  </div>
</template>


    <!-- Admin activity log -->
<template id="admin-log-template">
  <div class="spoilage-main">
    <div class="spoilage-header-top">
      <div>
        <h1>Admin Logs</h1>
        <div class="spoilage-subtitle">View all actions performed by admins in the system</div>
      </div>
    </div>
    <div class="report-generator-card">
      <div class="report-filters admin-log-filters">
        <div class="filter-controls">
                            <div class="filter-group">
                    <label for="adminLogActivityType">Activity Type</label>
                    <select id="adminLogActivityType">
                      <option value="all">All Activities</option>
                      <option value="LOGIN">Login</option>
                      <option value="LOGOUT">Logout</option>
                      <option value="ADD">Add</option>
                      <option value="UPDATE">Update</option>
                      <option value="DELETE">Delete</option>
                    </select>
                  </div>
          <div class="filter-group">
            <label for="adminLogDateRange">Date Range</label>
            <select id="adminLogDateRange" class="report-select">
              <option value="all">All Time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group" id="activityWeekGroup" style="display:none;min-width:200px;">
            <label for="activityWeekPicker" style="display:block;margin-bottom:6px;">Select Week</label>
            <input type="week" id="activityWeekPicker" class="report-select" />
          </div>
          <div class="filter-group" id="activityMonthGroup" style="display:none;min-width:200px;">
            <label for="activityMonthPicker" style="display:block;margin-bottom:6px;">Select Month</label>
            <input type="month" id="activityMonthPicker" class="report-select" />
          </div>
          <div class="filter-group" id="activityYearGroup" style="display:none;min-width:160px;">
            <label for="activityYearPicker" style="display:block;margin-bottom:6px;">Select Year</label>
            <input type="number" id="activityYearPicker" class="report-select" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          <div class="filter-group custom-date-inputs" style="display: none;">
            <label for="adminLogStartDate" style="display:block;margin-bottom:6px;">Start Date</label>
            <input type="date" id="adminLogStartDate" class="report-select" />
          </div>
          <div class="filter-group custom-date-inputs" style="display: none;">
            <label for="adminLogEndDate" style="display:block;margin-bottom:6px;">End Date</label>
            <input type="date" id="adminLogEndDate" class="report-select" />
          </div>
          <div class="filter-group">
            <label for="adminLogRecordsPerPage">Records per Page</label>
            <select id="adminLogRecordsPerPage" class="report-select" onchange="changeAdminLogRecordsPerPage(this.value)">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="filter-actions">
          <button class="filter-btn" id="adminLogFilterBtn">Filter</button>
          <button class="filter-btn export" id="adminLogDownloadExcel">Download Excel</button>
          <button class="filter-btn export" id="adminLogDownloadPDF">Download PDF</button>
        </div>
      </div>
      <div class="report-preview-area">
        <div class="report-preview-title">Admin Log</div>
        <table class="admin-log-table">
          <thead>
            <tr>
              <th>ADMIN</th>
              <th>ACTIVITY</th>
              <th>DATE/TIME</th>
              <th>DETAILS</th>
            </tr>
          </thead>
          <tbody id="adminLogTableBody">
            <!-- JS will render rows here -->
          </tbody>
        </table>
        <div id="adminLogPagination" class="pagination-container" style="display:none;">
          <!-- JS will render pagination here -->
        </div>
      </div>
    </div>
  </div>
</template>

<template id="feedbacks-template">
  <div class="feedbacks-container">
    <div class="feedbacks-header">
      <div>
        <h1>Feedback Dashboard</h1>
        <div class="feedbacks-subtitle">Manage customer feedback and support tickets</div>
      </div>
      <a href="#" class="feedbacks-tickets-link">8 feedbacks</a>
    </div>
    <div class="feedbacks-stats-row feedbacks-feedback-stats-row" style="display:grid;grid-template-columns:repeat(6,1fr);gap:16px;align-items:stretch;">
      <div class="feedbacks-stat-card feedbacks-stat-blue" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128172;</span>
        <div class="stat-label">Total</div>
        <div class="stat-value">0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-yellow" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#11088;</span>
        <div class="stat-label">Avg Rating</div>
        <div class="stat-value stat-rating">0.0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-green" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128515;</span>
        <div class="stat-label">Positive</div>
        <div class="stat-value">0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-yellow" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128994;</span>
        <div class="stat-label">5 Stars</div>
        <div class="stat-value">0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-red" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128196;</span>
        <div class="stat-label">Negative</div>
        <div class="stat-value">0</div>
      </div>
      <div class="feedbacks-stat-card feedbacks-stat-blue" style="display:flex;flex-direction:column;justify-content:center;">
        <span class="stat-icon">&#128337;</span>
        <div class="stat-label">Recent (3d)</div>
        <div class="stat-value">0</div>
      </div>
    </div>
    <div class="report-generator-card" style="padding:20px 24px;">
      <div class="report-filters feedbacks-filters" style="margin-bottom:0; display:flex; align-items:flex-end; gap:16px;">
        <div class="filter-controls" style="gap:12px; display:flex; flex-wrap:wrap; flex:1; align-items:flex-end;">
          <div class="filter-group">
            <label for="feedback-search">Name Search</label>
            <input type="text" id="feedback-search" class="feedbacks-search-input" placeholder="Search feedback name..." />
          </div>
          <div class="filter-group" style="min-width:180px;">
            <label for="feedbackDateRange">Date Range</label>
            <select id="feedbackDateRange" class="report-select">
              <option value="all">All Time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group" id="feedbackWeekGroup" style="display:none;min-width:200px;">
            <label for="feedbackWeekPicker">Select Week</label>
            <input type="week" id="feedbackWeekPicker" />
          </div>
          <div class="filter-group" id="feedbackMonthGroup" style="display:none;min-width:200px;">
            <label for="feedbackMonthPicker">Select Month</label>
            <input type="month" id="feedbackMonthPicker" />
          </div>
          <div class="filter-group" id="feedbackYearGroup" style="display:none;min-width:160px;">
            <label for="feedbackYearPicker">Select Year</label>
            <input type="number" id="feedbackYearPicker" min="1970" max="2100" step="1" placeholder="2025" />
          </div>
          <div class="filter-group custom-date-inputs" id="feedbackCustomDateGroup" style="display:none;min-width:180px;">
            <label for="feedback-date-from">Start Date</label>
            <input type="date" id="feedback-date-from" class="feedbacks-date-input" />
          </div>
          <div class="filter-group custom-date-inputs" style="display:none;min-width:180px;">
            <label for="feedback-date-to">End Date</label>
            <input type="date" id="feedback-date-to" class="feedbacks-date-input" />
          </div>
          <div class="filter-group" style="min-width:160px;">
            <label>Star Rating</label>
            <select class="feedbacks-filter-select">
              <option>All Ratings</option>
              <option>5</option>
              <option>4</option>
              <option>3</option>
              <option>2</option>
              <option>1</option>
            </select>
          </div>
          <div class="filter-group" style="min-width:160px;">
            <label>Sentiment</label>
            <select class="feedbacks-filter-select">
              <option>All</option>
              <option>Positive</option>
              <option>Negative</option>
              <option>Neutral</option>
            </select>
          </div>
          <div class="filter-group" style="min-width:160px;">
            <label for="feedbackRecordsPerPage">Records per Page</label>
            <select id="feedbackRecordsPerPage" class="report-select">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="filter-actions" style="gap:10px; display:flex; align-items:flex-end; justify-content:flex-end; margin-left:auto;">
          <button class="filter-btn" id="applyFeedbackFilters" type="button">üîé Filter</button>
          <button class="filter-btn export" id="export-feedbacks-excel" type="button">Download Excel</button>
          <button class="filter-btn export" id="export-feedbacks-pdf" type="button">Download PDF</button>
        </div>
      </div>
    </div>
    <div class="feedbacks-table-card">
      <table class="feedbacks-table">
        <thead>
          <tr>
            <th>FEEDBACK ID</th>
            <th>FEEDBACK TEXT</th>
            <th>FEEDBACK TYPE</th>
            <th>CUSTOMER NAME</th>
            <th>CUSTOMER EMAIL</th>
            <th>PRIORITY</th>
            <th>STAR RATE</th>
            <th>SENTIMENT</th>
            <th>STATUS</th>
            <th>ACTION</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data will be populated dynamically by JavaScript -->
        </tbody>
      </table>
      <div id="feedbacksPagination" class="pagination-container" style="display:none;">
        <div id="feedbacksPageInfo" class="pagination-info"></div>
        <div class="pagination-controls" id="feedbacksPageControls"></div>
      </div>
    </div>
  </div>
</template>

<!-- Device Management -->
<template id="device-management-template">
  <div class="device-management-container">
    <div class="device-management-header">
      <div>
        <h1>Device Management</h1>
        <div class="device-management-subtitle">Monitor and manage IoT devices, sensors, and equipment status across all users</div>
      </div>
      
    </div>
    
    <!-- KPI Cards -->
    <div class="device-management-stats-row">
      <div class="device-management-stat-card">
        <span class="stat-icon stat-blue">&#128187;</span>
        <div class="stat-label">Total Devices</div>
        <div class="stat-value">3</div>
        <div class="stat-trend">‚Üë 3 sensors</div>
      </div>
      <div class="device-management-stat-card">
        <span class="stat-icon stat-green">&#128200;</span>
        <div class="stat-label">Active Devices</div>
        <div class="stat-value">3</div>
        <div class="stat-trend">‚Üë 100% online</div>
      </div>
      <div class="device-management-stat-card">
        <span class="stat-icon stat-orange">&#9200;</span>
        <div class="stat-label">Device Health</div>
        <div class="stat-value">100%</div>
        <div class="stat-trend">‚Üë All operational</div>
      </div>
      <div class="device-management-stat-card">
        <span class="stat-icon stat-red">&#9888;</span>
        <div class="stat-label">Alerts</div>
        <div class="stat-value">0</div>
        <div class="stat-trend">‚Üì No issues</div>
      </div>
    </div>

    <!-- Main Content Cards -->
    <div class="device-management-main-cards">
      <!-- Device Status -->
      <div class="device-management-card">
        <div class="device-management-card-header">
          <h3>Device Activities</h3>
          <div class="device-management-card-actions">
            <button id="addDeviceBtn" class="device-management-btn-primary" style="margin-left:8px;">+ Add Device</button>
          </div>
        </div>
        <div class="device-filters-row">
          <div class="df-item df-wide">
            <label>Name Search</label>
            <input id="dfSearch" placeholder="Search device or user..." />
          </div>
          <div class="df-item">
            <label>Type</label>
            <select id="dfType">
              <option value="">All</option>
              <option value="Temperature">Temperature</option>
              <option value="Humidity">Humidity</option>
              <option value="Gas">Gas</option>
            </select>
          </div>
          <div class="df-item">
            <label>Status</label>
            <select id="dfStatus">
              <option value="">All</option>
              <option value="ONLINE">ONLINE</option>
              <option value="OFFLINE">OFFLINE</option>
            </select>
          </div>
          
          <div class="df-item">
            <label>Records per Page</label>
            <select id="dfPageSize">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
          <div class="df-item df-actions">
            <label>&nbsp;</label>
            <div class="df-action-buttons">
              <button type="button" class="filter-btn" id="inlineApplyFilters">Filter</button>
              <button type="button" class="filter-btn export" id="downloadCsvBtn">Download CSV</button>
              <button type="button" class="filter-btn export" id="downloadPdfBtn">Download PDF</button>
            </div>
          </div>
        </div>
        
        <div class="device-management-table-container">
          <table class="device-management-table">
            <thead>
              <tr>
                <th>Device ID</th>
                <th>Device Name</th>
                <th>User</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="deviceActivitiesTableBody">
              <!-- Device status will be populated dynamically by JavaScript -->
            </tbody>
          </table>
        </div>
        <div class="device-pagination-row fancy">
          <div class="dp-left"><span id="dpRangeInfo" style="color:#bfc9da;">Showing 0 to 0 of 0 records</span></div>
          <div class="dp-right">
            <div id="dpNumbers" class="dp-numbers"></div>
            <button id="dpNext" class="device-management-filter-btn">Next ‚Ä∫</button>
          </div>
        </div>
      </div>

      
    </div>
  </div>
</template>

<!-- Device Details Modal -->
<div id="deviceDetailsModal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Device Details</h3>
      <span class="close" id="closeDeviceDetailsModal" style="cursor:pointer;">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-group"><label>Device ID</label><div id="ddmDeviceId"></div></div>
      <div class="form-group"><label>Device Name</label><div id="ddmDeviceName"></div></div>
      <div class="form-group"><label>Type</label><div id="ddmDeviceType"></div></div>
      <div class="form-group"><label>Status</label><div id="ddmDeviceStatus"></div></div>
      <div class="form-group"><label>User</label><div id="ddmUserName"></div></div>
      <div class="form-group"><label>User Email</label><div id="ddmUserEmail"></div></div>
      <div class="form-group"><label>Created At</label><div id="ddmCreatedAt"></div></div>
      <div class="form-group"><label>Last Update</label><div id="ddmLastUpdate"></div></div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" id="deviceDetailsCloseBtn">Close</button>
    </div>
  </div>
  <style>
    /* Reuse existing modal styling baseline */
    #deviceDetailsModal .modal-content { max-width: 480px; }
    #deviceDetailsModal .form-group { margin: 6px 0; }
    #deviceDetailsModal .form-group label { display:block;color:#bfc9da;margin-bottom:4px; }
    #deviceDetailsModal .form-group div { color:#fff;background:#181f36;padding:6px 8px;border-radius:6px;border:1px solid #2a3b6d; }
    
  </style>
</div>

<!-- Confirm Modal -->
<div id="confirmModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:420px;">
    <div class="modal-header">
      <h3 id="confirmTitle">Confirm</h3>
      <span class="close" id="confirmClose" style="cursor:pointer;">&times;</span>
    </div>
    <div class="modal-body">
      <div id="confirmMessage" style="color:#e0e6f6;">Are you sure?</div>
    </div>
    <div class="modal-footer" style="display:flex;gap:8px;justify-content:flex-end;">
      <button type="button" class="btn btn-secondary" id="confirmCancel">Cancel</button>
      <button type="button" class="btn btn-primary" id="confirmOk">OK</button>
    </div>
  </div>
</div>

<!-- Device Filters Modal -->
<div id="deviceFilterModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:560px;">
    <div class="modal-header">
      <h3>Filters</h3>
      <span class="close" id="deviceFilterClose" style="cursor:pointer;">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="form-group">
          <label>Type</label>
          <select id="filterType" style="width:100%;background:#181f36;color:#fff;border:1px solid #2a3b6d;border-radius:8px;padding:10px 12px;">
            <option value="">All</option>
            <option value="Temperature">Temperature</option>
            <option value="Humidity">Humidity</option>
            <option value="Gas">Gas</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="filterStatus" style="width:100%;background:#181f36;color:#fff;border:1px solid #2a3b6d;border-radius:8px;padding:10px 12px;">
            <option value="">All</option>
            <option value="ONLINE">ONLINE</option>
            <option value="OFFLINE">OFFLINE</option>
          </select>
        </div>
      </div>
      <div class="form-group"><label>User (username/email)</label>
        <input id="filterUser" placeholder="Search user..." style="width:100%;background:#181f36;color:#fff;border:1px solid #2a3b6d;border-radius:8px;padding:10px 12px;">
      </div>
    </div>
    <div class="modal-footer" style="display:flex;gap:8px;justify-content:flex-end;">
      <button type="button" class="btn btn-secondary" id="clearFilters">Clear</button>
      <button type="button" class="btn btn-primary" id="applyFilters">Apply</button>
    </div>
  </div>
  <style>
    #deviceFilterModal .modal-content { max-width: 560px; }
  </style>
</div>
<!-- Add Device Modal -->
<div id="addDeviceModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:560px;">
    <div class="modal-header">
      <h3>Add Device</h3>
      <span class="close" id="addDeviceClose" style="cursor:pointer;">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-row" style="display:grid;grid-template-columns:1fr;gap:12px;margin-top:4px;">
        <div class="form-group">
          <label style="display:flex;align-items:center;gap:8px;color:#cfe0ff;font-weight:600;margin-bottom:6px;">
            <span style="color:#ff6b6b;">üå°Ô∏è</span>
            <span>Temperature Sensor ID</span>
          </label>
          <input id="tempSensorId" placeholder="Enter temperature sensor ID" style="display:block;width:100%;max-width:100%;box-sizing:border-box;background:#202b4a;color:#e6ecff;border:1px solid #31426f;border-radius:10px;padding:12px 14px;outline:none;">
        </div>
        <div class="form-group">
          <label style="display:flex;align-items:center;gap:8px;color:#cfe0ff;font-weight:600;margin-bottom:6px;">
            <span style="color:#6bc1ff;">üíß</span>
            <span>Humidity Sensor ID</span>
          </label>
          <input id="humSensorId" placeholder="Enter humidity sensor ID" style="display:block;width:100%;max-width:100%;box-sizing:border-box;background:#202b4a;color:#e6ecff;border:1px solid #31426f;border-radius:10px;padding:12px 14px;outline:none;">
        </div>
        <div class="form-group">
          <label style="display:flex;align-items:center;gap:8px;color:#cfe0ff;font-weight:600;margin-bottom:6px;">
            <span style="color:#ffd166;">‚ö°</span>
            <span>Gas Sensor ID</span>
          </label>
          <input id="gasSensorId" placeholder="Enter gas sensor ID" style="display:block;width:100%;max-width:100%;box-sizing:border-box;background:#202b4a;color:#e6ecff;border:1px solid #31426f;border-radius:10px;padding:12px 14px;outline:none;">
      </div>
        </div>
      <div class="form-row" style="display:grid;grid-template-columns:1fr;gap:12px;margin-top:8px;">
        <div class="form-group"><label style="color:#cfe0ff;font-weight:600;margin-bottom:6px;">Account</label>
          <input id="adAccount" placeholder="Enter account" style="display:block;width:100%;max-width:100%;box-sizing:border-box;background:#202b4a;color:#e6ecff;border:1px solid #31426f;border-radius:10px;padding:12px 14px;">
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display:flex;gap:8px;justify-content:flex-end;">
      <button type="button" class="btn btn-secondary" id="addDeviceCancel">Cancel</button>
      <button type="button" class="btn btn-primary" id="addDeviceSave">Add Device</button>
    </div>
  </div>
</div>

<!-- ML Training Data Modal -->
<div id="mlTrainingDataModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h3>Add Training Data</h3>
      <span class="close" id="closeMlTrainingModal" style="cursor:pointer;">&times;</span>
    </div>
    <div class="modal-body">
      <p style="color: #bfc9da; margin-bottom: 20px;">Enter the details for the new training data sample.</p>
      
      <form id="mlTrainingDataForm">
        <!-- Food Name & Category Row -->
        <div class="ml-form-row">
          <div class="ml-form-group">
            <label for="mlFoodName">Food Name</label>
            <input type="text" id="mlFoodName" name="foodName" placeholder="e.g., CARROT" required>
          </div>
          <div class="ml-form-group">
            <label for="mlCategory">Category</label>
            <input type="text" id="mlCategory" name="category" placeholder="e.g., VEGETABLE" required>
          </div>
        </div>
        
        <!-- Temperature, Humidity & pH Row -->
        <div class="ml-form-row ml-form-row-three">
          <div class="ml-form-group">
            <label for="mlTemperature">Temperature (¬∞C)</label>
            <input type="number" id="mlTemperature" name="temperature" placeholder="25" step="0.1" required>
          </div>
          <div class="ml-form-group">
            <label for="mlHumidity">Humidity (%)</label>
            <input type="number" id="mlHumidity" name="humidity" placeholder="25" step="0.1" required>
          </div>
          <div class="ml-form-group">
            <label for="mlPh">pH (ppm)</label>
            <input type="number" id="mlPh" name="ph" placeholder="25" step="0.1" required>
          </div>
        </div>
        
        <!-- Actual Status & Source Row -->
        <div class="ml-form-row">
          <div class="ml-form-group">
            <label for="mlActualStatus">Actual Status</label>
            <select id="mlActualStatus" name="actualStatus" required>
              <option value="">Select status</option>
              <option value="safe">safe</option>
              <option value="caution">caution</option>
              <option value="unsafe">unsafe</option>
            </select>
          </div>
          <div class="ml-form-group">
            <label for="mlSource">Data Source</label>
            <select id="mlSource" name="source" required>
              <option value="">Select source</option>
              <option value="manual">manual</option>
              <option value="sensor">sensor</option>
              <option value="user_feedback">user_feedback</option>
              <option value="expert">expert</option>
            </select>
          </div>
        </div>
        
        <!-- Data Quality Row (Full Width) -->
        <div class="ml-form-group ml-form-group-full">
          <label for="mlDataQuality">Data Quality (%)</label>
          <input type="number" id="mlDataQuality" name="dataQuality" placeholder="95" min="0" max="100" step="1" required>
        </div>
      </form>
    </div>
    <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
      <button type="button" class="btn btn-secondary" id="cancelMlTrainingBtn">Cancel</button>
      <button type="button" class="btn btn-primary" id="addMlTrainingDataBtn">Add Training Data</button>
    </div>
  </div>
</div>

<!-- Response Modal -->
<div id="responseModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Respond to Feedback</h3>
      <span class="close" onclick="closeResponseModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div class="feedback-details">
        <h4>Feedback Details</h4>
        <div id="modalFeedbackText" class="feedback-text"></div>
        <div class="feedback-info">
          <span id="modalCustomerName"></span> ‚Ä¢ 
          <span id="modalFeedbackType"></span> ‚Ä¢ 
          <span id="modalPriority"></span>
        </div>
      </div>
      
      <div class="form-group">
        <label for="responseStatus">Status:</label>
        <select id="responseStatus" class="form-control">
          <option value="Active">Active</option>
          <option value="Resolved">Resolved</option>
          <option value="Archived">Archived</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="adminNotes">Admin Notes:</label>
        <textarea id="adminNotes" class="form-control" placeholder="Add internal notes..."></textarea>
      </div>
      
      <div class="form-group">
        <label for="responseText">Response to Customer:</label>
        <textarea id="responseText" class="form-control" placeholder="Type your response to the customer..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="closeResponseModal()">Cancel</button>
      <button type="button" class="btn btn-primary" onclick="saveResponse()">Save Response</button>
    </div>
  </div>
</div>

<!-- Admin Account Details Modal -->
<div class="user-modal" id="adminAccountModal" style="display:none;z-index:2000;">
  <div class="user-modal-content" style="max-width: 500px; width: 90%;">
    <h2>Admin Account Details</h2>
    <form id="adminAccountForm">
      <div id="adminUpdateNotice" class="sb-notice" style="display:none; margin-bottom:10px;"></div>
      <input type="hidden" id="adminAccountId" />
      
      <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
        <div class="form-group" style="flex: 1;">
          <label for="adminEmail">Account (Email) *</label>
          <input type="email" id="adminEmail" required placeholder="admin@example.com" />
        </div>
        <div class="form-group" style="flex: 1;">
          <label for="adminUsername">Username</label>
          <input type="text" id="adminUsername" placeholder="Enter username" />
        </div>
      </div>

      <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
        <div class="form-group" style="flex: 1;">
          <label for="adminFirstName">First Name *</label>
          <input type="text" id="adminFirstName" required placeholder="First name" />
        </div>
        <div class="form-group" style="flex: 1;">
          <label for="adminLastName">Last Name *</label>
          <input type="text" id="adminLastName" required placeholder="Last name" />
        </div>
      </div>

      <div class="form-group" style="margin-bottom: 15px;">
        <label for="adminPassword">Create New Password</label>
        <input type="text" id="adminPassword" placeholder="Create new password (optional)" />
      </div>

      <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
        <div class="form-group" style="flex: 1;">
          <label for="adminRole">Role</label>
          <input type="text" id="adminRole" value="Admin" readonly />
        </div>
        <div class="form-group" style="flex: 1;">
          <label for="adminPhone">Phone</label>
          <input type="tel" id="adminPhone" placeholder="+1 555-123-4567" />
        </div>
      </div>

      <div class="form-group" style="margin-bottom: 20px;">
        <label for="adminCreated">Created At</label>
        <input type="text" id="adminCreated" readonly />
      </div>

      <div class="modal-actions" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
        <button type="submit" class="filter-btn" style="background: #4a5b8d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">Save</button>
        <button type="button" class="filter-btn export" id="cancelAdminAccountBtn" style="background: #2a3b6d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script src="../assets/js/config/api-config.js"></script>
<script src="../assets/js/Admin/sidebarexpand.js"></script>
<script src="../assets/js/Admin/analyticstat.js"></script>
<script src="../assets/js/Admin/ad-chart.js"></script>
<script src="../assets/js/Admin/Sensoranalytic.js"></script>
<script src="../assets/js/Admin/sensor-analytics-connector.js"></script>
<script src="../assets/js/Admin/spa.js"></script>
<script src="../assets/js/Admin/report-generator.js"></script>
<script src="../assets/js/Admin/user.js"></script>
<script src="../assets/js/Admin/user-activity-log.js"></script>
<script src="../assets/js/Admin/admin-log.js"></script>
<!-- <script src="../assets/js/Admin/account-modal.js"></script> --> <!-- Replaced with new admin account modal -->
<!-- Initialize all dashboard charts -->

<script>
// Initialize dashboard with real data when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Wait for the dashboard to be loaded by SPA
  setTimeout(() => {
    if (window.fetchDashboardStats) {
      window.fetchDashboardStats();
    }
  }, 1000);
});

function handleAdminPassFormSubmit(e) {
  e.preventDefault();
  const input = document.getElementById('adminPassInput');
  if (input.value === ADMIN_PASSWORD) {
    closeAdminPassModal();
    setTimeout(() => {
      if (pendingUserAction) {
        if (pendingUserAction.type === 'add') {
          openUserModal();
          const nameInput = document.getElementById('userName');
          if (nameInput) nameInput.focus();
        }
        if (pendingUserAction.type === 'edit') {
          openUserModal(pendingUserAction.user);
          const nameInput = document.getElementById('userName');
          if (nameInput) nameInput.focus();
        }
      }
    }, 100);
  } else {
    input.value = '';
    input.placeholder = 'Incorrect password';
    input.classList.add('error');
    setTimeout(() => { input.placeholder = ''; input.classList.remove('error'); }, 1200);
  }
}
</script>

<!-- Old Admin Account Modal - Replaced with new one in template -->
<!--
<div id="accountModal" class="account-modal" style="display:none;">
  <div class="account-modal-content">
    <span class="account-modal-close" id="accountModalClose">&times;</span>
    <h2>Admin Account Details</h2>
    <form id="accountModalForm">
      <div class="account-form-group">
        <label for="account-username">Account (Email/Username)</label>
        <input type="text" id="account-username" name="account-username" required>
      </div>
      <div class="account-form-group">
        <label for="account-name">Name</label>
        <input type="text" id="account-name" name="account-name" required>
      </div>
      <div class="account-form-group">
        <label for="account-password">Password</label>
        <input type="password" id="account-password" name="account-password" required>
      </div>
      <div class="account-form-group">
        <label for="account-role">Role</label>
        <input type="text" id="account-role" name="account-role" value="Admin" readonly>
      </div>
      <div class="account-form-group">
        <label for="account-phone">Phone</label>
        <input type="text" id="account-phone" name="account-phone">
      </div>
      <div class="account-form-group">
        <label for="account-created">Created</label>
        <input type="text" id="account-created" name="account-created" readonly>
      </div>
      <div class="account-modal-actions">
        <button type="submit" class="account-modal-save">Save</button>
        <button type="button" class="account-modal-cancel" id="accountModalCancel">Cancel</button>
      </div>
    </form>
  </div>
</div>
-->

<!-- Admin Logout Logic -->
<script>
(function() {
  // Prevent event bubbling from logout button to parent (which may open modal)
  var logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', function(e) {
      e.stopPropagation(); // Prevent parent click events
      
      // Get JWT token from multiple possible locations
      const jwtToken = localStorage.getItem('jwt_token') || 
                       localStorage.getItem('sessionToken') || 
                       localStorage.getItem('session_token');
      
      if (jwtToken) {
        // Call backend logout API to log the activity
        fetch('/api/auth/logout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${jwtToken}`
          }
        })
        .then(response => response.json())
        .then(data => {
          // Clear all session/user data regardless of API response
          clearAllStorage();
          
          // Show logout message (toast)
          showLogoutToast('Logging out...');
          setTimeout(() => {
            window.location.href = '/admin-login';
          }, 1200);
        })
        .catch(error => {
          console.error('Logout API error:', error);
          // Still logout even if API fails
          clearAllStorage();
          
          showLogoutToast('Logging out...');
          setTimeout(() => {
            window.location.href = '/admin-login';
          }, 1200);
        });
      } else {
        // Fallback if no token
        clearAllStorage();
        
        showLogoutToast('Logging out...');
        setTimeout(() => {
          window.location.href = '/admin-login';
        }, 1200);
      }
      
      // Helper function to clear all storage
      function clearAllStorage() {
        localStorage.removeItem('jwt_token');
        localStorage.removeItem('user_data');
        localStorage.removeItem('session_token');
        localStorage.removeItem('currentUser');
        localStorage.removeItem('currentAdmin');
        localStorage.removeItem('admin_data');
        localStorage.removeItem('sessionToken');
        localStorage.removeItem('sessionExpires');
        sessionStorage.clear();
      }
      
      // Helper function to show logout toast
      function showLogoutToast(message) {
        var toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #4caf50;
          color: white;
          padding: 15px 20px;
          border-radius: 8px;
          z-index: 10000;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        `;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => {
          if (toast.parentNode) toast.parentNode.removeChild(toast);
        }, 1200);
      }
    });
  }
})();
</script>

<!-- Feedbacks JavaScript -->
<script src="../assets/js/Admin/feedbacks.js"></script>
<!-- Device Management JavaScript -->
<script src="../assets/js/Admin/device-management.js"></script>

<!-- Admin Activity Logging Helper -->
<script>
(function() {
  function getAuthToken() {
    return localStorage.getItem('jwt_token') || localStorage.getItem('sessionToken') || localStorage.getItem('session_token') || '';
  }

  function buildAdminDetails(context) {
    try {
      if (!context) return '';
      // Normalize known contexts into concise descriptions
      const page = (context.page || '').trim();
      const target = (context.target || '').trim();
      const extra = (context.extra || '').trim();
      if (context.action === 'LOGIN') return 'Logged in';
      if (context.action === 'LOGOUT') return 'Logged out';
      if (context.action === 'ADD') {
        if (page === 'users') return 'Added: User';
        if (page === 'devices') return 'Added: Device';
        return 'Added';
      }
      if (context.action === 'UPDATE') {
        if (page === 'analytics') return 'Updated: on Analytics Filters';
        if (page === 'devices' && target === 'filters') return 'Updated: on Device Management Filters';
        if (page === 'users' && target === 'filters') return 'Updated: on Users Filters';
        if (target) return `Updated: ${target}`;
        return 'Updated';
      }
      if (context.action === 'DELETE') {
        if (page === 'users') return 'Deleted: User';
        if (page === 'devices') return 'Deleted: Device';
        return 'Deleted';
      }
      return extra || '';
    } catch(_) { return ''; }
  }

  async function logAdminActivity(action, details) {
    // Disabled client-side POST to avoid 404 noise; rely on backend middleware/route-specific logs
    return;
  }

  // Expose globally for other modules
  window.logAdminActivity = logAdminActivity;

  // Wire common actions
  document.addEventListener('DOMContentLoaded', function() {
    // Logout button
    var logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function() {
        logAdminActivity('LOGOUT', { page: 'account' });
      });
    }

    // Add user
    var addUserBtn = document.getElementById('addUserBtn');
    // Do not log opening of Add User modal

    // Add device save button in template
    var addDeviceSave = document.getElementById('addDeviceSave');
    if (addDeviceSave) {
      addDeviceSave.addEventListener('click', function() {
        logAdminActivity('ADD', { page: 'devices' });
      });
    }

    // Filters apply (treat as UPDATE)
    // Intentionally do not log filter apply actions per requirement

    // Generic delegation for ADD/UPDATE/DELETE buttons
    document.body.addEventListener('click', function(e) {
      var el = e.target.closest('button, a');
      if (!el) return;
      var txt = (el.textContent || '').toLowerCase();
      if (txt.includes('delete') || el.classList.contains('delete') || el.id.toLowerCase().includes('delete')) {
        logAdminActivity('DELETE', { page: 'devices' });
      } else if (txt.includes('add') || txt.startsWith('+') || el.classList.contains('add') || el.id.toLowerCase().includes('add')) {
        // Try to infer context
        const inUsers = !!document.getElementById('users-template') && !!document.getElementById('userModal');
        logAdminActivity('ADD', { page: inUsers ? 'users' : 'devices' });
      } else if (
        txt.includes('save') ||
        txt.includes('update') ||
        txt.includes('edit') ||
        el.classList.contains('save') ||
        el.classList.contains('edit') ||
        el.id.toLowerCase().includes('save') ||
        el.id.toLowerCase().includes('update') ||
        el.id.toLowerCase().includes('edit')
      ) {
        logAdminActivity('UPDATE', { page: 'devices' });
      }
    });
  });
})();
</script>


</body>
</html>

